<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Learning Outcomes &#8212; Practical Quantum Computing for Scientists 2022.02.24 alpha documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/mystnb.css" />
    <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
    <script src="../../../../../_static/jquery.js"></script>
    <script src="../../../../../_static/underscore.js"></script>
    <script src="../../../../../_static/doctools.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../../../../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../../../../../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../../../../../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../../../../_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default ">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../../../index.html">
          Practical QC for Scientists</a>
        <span class="navbar-text navbar-version pull-left"><b>2022.02.24</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../../../PHYS437/index.html">437</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../../../index.html">Contents <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../index.html">Courses</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../PHYS437/index.html">PHYS 437</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../archives.html">Archives</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../help/index.html">HOWTOs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../help/IBM_quantum.html">Using IBM quantum Cloud</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <section class="tex2jax_ignore mathjax_ignore" id="learning-outcomes">
<h1>Learning Outcomes<a class="headerlink" href="#learning-outcomes" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>Quantum Teleportation</p></li>
<li><p>Superdense Coding</p></li>
<li><p>Quantum Key Distribution</p></li>
</ul>
<p>This notebook demonstrates quantum teleportation. We first use Qiskit’s built-in simulators to test our quantum circuit, and then try it out on a real quantum computer.</p>
<section id="contents">
<h2>Contents<a class="headerlink" href="#contents" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p><a class="reference external" href="#overview">Overview</a></p></li>
<li><p><a class="reference external" href="#how">The Quantum Teleportation Protocol</a></p></li>
<li><p><a class="reference external" href="#simulating">Simulating the Teleportation Protocol</a><br />
3.1 <a class="reference external" href="#testing">How will we Test this Result on a Real Quantum Computer?</a><br />
3.2 <a class="reference external" href="#simulating-sv">Using the Statevector Simulator</a><br />
3.3 <a class="reference external" href="#simulating-qs">Using the QASM Simulator</a></p></li>
<li><p><a class="reference external" href="#understanding-qt">Understanding Quantum Teleportation</a></p></li>
<li><p><a class="reference external" href="#real_qc">Teleportation on a Real Quantum Computer</a><br />
5.1 <a class="reference external" href="#deferred-measurement">IBM hardware and Deferred Measurement</a><br />
5.2 <a class="reference external" href="#executing">Executing</a></p></li>
<li><p><a class="reference external" href="#references">References</a></p></li>
</ol>
</section>
<section id="overview-a-id-overview-a">
<h2>1. Overview <a id='overview'></a><a class="headerlink" href="#overview-a-id-overview-a" title="Permalink to this headline">¶</a></h2>
<p>Alice wants to send quantum information to Bob. Specifically, suppose she wants to send the qubit state
<span class="math notranslate nohighlight">\(\vert\psi\rangle = \alpha\vert0\rangle + \beta\vert1\rangle\)</span>.
This entails passing on information about <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span> to Bob.</p>
<p>There exists a theorem in quantum mechanics which states that you cannot simply make an exact copy of an unknown quantum state. This is known as the no-cloning theorem. As a result of this we can see that Alice can’t simply generate a copy of <span class="math notranslate nohighlight">\(\vert\psi\rangle\)</span> and give the copy to Bob. We can only copy classical states (not superpositions).</p>
<p>However, by taking advantage of two classical bits and an entangled qubit pair, Alice can transfer her state <span class="math notranslate nohighlight">\(\vert\psi\rangle\)</span> to Bob. We call this teleportation because, at the end, Bob will have <span class="math notranslate nohighlight">\(\vert\psi\rangle\)</span> and Alice won’t anymore.</p>
</section>
<section id="the-quantum-teleportation-protocol-a-id-how-a">
<h2>2. The Quantum Teleportation Protocol <a id='how'></a><a class="headerlink" href="#the-quantum-teleportation-protocol-a-id-how-a" title="Permalink to this headline">¶</a></h2>
<p>To transfer a quantum bit, Alice and Bob must use a third party (Telamon) to send them an entangled qubit pair. Alice then performs some operations on her qubit, sends the results to Bob over a classical communication channel, and Bob then performs some operations on his end to receive Alice’s qubit.</p>
<p><img alt="image.png" src="courses/archives/PHYS343/hands-ons/hands-on-7/attachment:image.png" /></p>
<p>We will describe the steps on a quantum circuit below. Here, no qubits are actually ‘sent’, you’ll just have to imagine that part!</p>
<p>First we set up our session:</p>
<div class="cell tag_thebelab-init docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Do the necessary imports</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="n">QuantumCircuit</span><span class="p">,</span> <span class="n">QuantumRegister</span><span class="p">,</span> <span class="n">ClassicalRegister</span>
<span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="n">IBMQ</span><span class="p">,</span> <span class="n">Aer</span><span class="p">,</span> <span class="n">transpile</span><span class="p">,</span> <span class="n">assemble</span>
<span class="kn">from</span> <span class="nn">qiskit.visualization</span> <span class="kn">import</span> <span class="n">plot_histogram</span><span class="p">,</span> <span class="n">plot_bloch_multivector</span>
<span class="kn">from</span> <span class="nn">qiskit.extensions</span> <span class="kn">import</span> <span class="n">Initialize</span>
<span class="kn">from</span> <span class="nn">qiskit_textbook.tools</span> <span class="kn">import</span> <span class="n">random_state</span><span class="p">,</span> <span class="n">array_to_latex</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Input</span> <span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="kn">from</span> <span class="nn">qiskit.visualization</span> <span class="kn">import</span> <span class="n">plot_histogram</span><span class="p">,</span> <span class="n">plot_bloch_multivector</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="kn">from</span> <span class="nn">qiskit.extensions</span> <span class="kn">import</span> <span class="n">Initialize</span>
<span class="ne">----&gt; </span><span class="mi">7</span> <span class="kn">from</span> <span class="nn">qiskit_textbook.tools</span> <span class="kn">import</span> <span class="n">random_state</span><span class="p">,</span> <span class="n">array_to_latex</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;qiskit_textbook&#39;
</pre></div>
</div>
</div>
</div>
<p>and create our quantum circuit:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## SETUP</span>
<span class="c1"># Protocol uses 3 qubits and 2 classical bits in 2 different registers</span>

<span class="n">qr</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;q&quot;</span><span class="p">)</span>    <span class="c1"># Protocol uses 3 qubits</span>
<span class="n">crz</span> <span class="o">=</span> <span class="n">ClassicalRegister</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;crz&quot;</span><span class="p">)</span> <span class="c1"># and 2 classical bits</span>
<span class="n">crx</span> <span class="o">=</span> <span class="n">ClassicalRegister</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;crx&quot;</span><span class="p">)</span> <span class="c1"># in 2 different registers</span>
<span class="n">teleportation_circuit</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">qr</span><span class="p">,</span> <span class="n">crz</span><span class="p">,</span> <span class="n">crx</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="step-1">
<h3>Step 1<a class="headerlink" href="#step-1" title="Permalink to this headline">¶</a></h3>
<p>A third party, Telamon, creates an entangled pair of qubits and gives one to Bob and one to Alice.</p>
<p>The pair Telamon creates is a special pair called a Bell pair. In quantum circuit language, the way to create a Bell pair between two qubits is to first transfer one of them to the X-basis (<span class="math notranslate nohighlight">\(|+\rangle\)</span> and <span class="math notranslate nohighlight">\(|-\rangle\)</span>) using a Hadamard gate, and then to apply a CNOT gate onto the other qubit controlled by the one in the X-basis.</p>
<div class="cell tag_thebelab-init docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_bell_pair</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a bell pair in qc using qubits a &amp; b&quot;&quot;&quot;</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="c1"># Put qubit a into state |+&gt;</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="c1"># CNOT with a as control and b as target</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## SETUP</span>
<span class="c1"># Protocol uses 3 qubits and 2 classical bits in 2 different registers</span>
<span class="n">qr</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;q&quot;</span><span class="p">)</span>
<span class="n">crz</span><span class="p">,</span> <span class="n">crx</span> <span class="o">=</span> <span class="n">ClassicalRegister</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;crz&quot;</span><span class="p">),</span> <span class="n">ClassicalRegister</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;crx&quot;</span><span class="p">)</span>
<span class="n">teleportation_circuit</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">qr</span><span class="p">,</span> <span class="n">crz</span><span class="p">,</span> <span class="n">crx</span><span class="p">)</span>

<span class="c1">## STEP 1</span>
<span class="c1"># In our case, Telamon entangles qubits q1 and q2</span>
<span class="c1"># Let&#39;s apply this to our circuit:</span>
<span class="n">create_bell_pair</span><span class="p">(</span><span class="n">teleportation_circuit</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="c1"># And view the circuit so far:</span>
<span class="n">teleportation_circuit</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../../_images/lab7-book_11_0.png" src="../../../../../_images/lab7-book_11_0.png" />
</div>
</div>
<p>Let’s say Alice owns <span class="math notranslate nohighlight">\(q_1\)</span> and Bob owns <span class="math notranslate nohighlight">\(q_2\)</span> after they part ways.</p>
</section>
<section id="step-2">
<h3>Step 2<a class="headerlink" href="#step-2" title="Permalink to this headline">¶</a></h3>
<p>Alice applies a CNOT gate to <span class="math notranslate nohighlight">\(q_1\)</span>, controlled by <span class="math notranslate nohighlight">\(\vert\psi\rangle\)</span> (the qubit she is trying to send Bob). Then Alice applies a Hadamard gate to <span class="math notranslate nohighlight">\(|\psi\rangle\)</span>. In our quantum circuit, the qubit (<span class="math notranslate nohighlight">\(|\psi\rangle\)</span>) Alice is trying to send is <span class="math notranslate nohighlight">\(q_0\)</span>:</p>
<div class="cell tag_thebelab-init docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">alice_gates</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## SETUP</span>
<span class="c1"># Protocol uses 3 qubits and 2 classical bits in 2 different registers</span>
<span class="n">qr</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;q&quot;</span><span class="p">)</span>
<span class="n">crz</span><span class="p">,</span> <span class="n">crx</span> <span class="o">=</span> <span class="n">ClassicalRegister</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;crz&quot;</span><span class="p">),</span> <span class="n">ClassicalRegister</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;crx&quot;</span><span class="p">)</span>
<span class="n">teleportation_circuit</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">qr</span><span class="p">,</span> <span class="n">crz</span><span class="p">,</span> <span class="n">crx</span><span class="p">)</span>

<span class="c1">## STEP 1</span>
<span class="n">create_bell_pair</span><span class="p">(</span><span class="n">teleportation_circuit</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1">## STEP 2</span>
<span class="n">teleportation_circuit</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span> <span class="c1"># Use barrier to separate steps</span>
<span class="n">alice_gates</span><span class="p">(</span><span class="n">teleportation_circuit</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">teleportation_circuit</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../../_images/lab7-book_14_0.png" src="../../../../../_images/lab7-book_14_0.png" />
</div>
</div>
</section>
<section id="step-3">
<h3>Step 3<a class="headerlink" href="#step-3" title="Permalink to this headline">¶</a></h3>
<p>Next, Alice applies a measurement to both qubits that she owns, <span class="math notranslate nohighlight">\(q_1\)</span> and <span class="math notranslate nohighlight">\(\vert\psi\rangle\)</span>, and stores this result in two classical bits. She then sends these two bits to Bob.</p>
<div class="cell tag_thebelab-init docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">measure_and_send</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Measures qubits a &amp; b and &#39;sends&#39; the results to Bob&quot;&quot;&quot;</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## SETUP</span>
<span class="c1"># Protocol uses 3 qubits and 2 classical bits in 2 different registers</span>
<span class="n">qr</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;q&quot;</span><span class="p">)</span>
<span class="n">crz</span><span class="p">,</span> <span class="n">crx</span> <span class="o">=</span> <span class="n">ClassicalRegister</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;crz&quot;</span><span class="p">),</span> <span class="n">ClassicalRegister</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;crx&quot;</span><span class="p">)</span>
<span class="n">teleportation_circuit</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">qr</span><span class="p">,</span> <span class="n">crz</span><span class="p">,</span> <span class="n">crx</span><span class="p">)</span>

<span class="c1">## STEP 1</span>
<span class="n">create_bell_pair</span><span class="p">(</span><span class="n">teleportation_circuit</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1">## STEP 2</span>
<span class="n">teleportation_circuit</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span> <span class="c1"># Use barrier to separate steps</span>
<span class="n">alice_gates</span><span class="p">(</span><span class="n">teleportation_circuit</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">## STEP 3</span>
<span class="n">measure_and_send</span><span class="p">(</span><span class="n">teleportation_circuit</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">teleportation_circuit</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../../_images/lab7-book_17_0.png" src="../../../../../_images/lab7-book_17_0.png" />
</div>
</div>
</section>
<section id="step-4">
<h3>Step 4<a class="headerlink" href="#step-4" title="Permalink to this headline">¶</a></h3>
<p>Bob, who already has the qubit <span class="math notranslate nohighlight">\(q_2\)</span>, then applies the following gates depending on the state of the classical bits:</p>
<p>00 <span class="math notranslate nohighlight">\(\rightarrow\)</span> Do nothing</p>
<p>01 <span class="math notranslate nohighlight">\(\rightarrow\)</span> Apply <span class="math notranslate nohighlight">\(X\)</span> gate</p>
<p>10 <span class="math notranslate nohighlight">\(\rightarrow\)</span> Apply <span class="math notranslate nohighlight">\(Z\)</span> gate</p>
<p>11 <span class="math notranslate nohighlight">\(\rightarrow\)</span> Apply <span class="math notranslate nohighlight">\(ZX\)</span> gate</p>
<p>(<em>Note that this transfer of information is purely classical</em>.)</p>
<div class="cell tag_thebelab-init docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This function takes a QuantumCircuit (qc), integer (qubit)</span>
<span class="c1"># and ClassicalRegisters (crz &amp; crx) to decide which gates to apply</span>
<span class="k">def</span> <span class="nf">bob_gates</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">qubit</span><span class="p">,</span> <span class="n">crz</span><span class="p">,</span> <span class="n">crx</span><span class="p">):</span>
    <span class="c1"># Here we use c_if to control our gates with a classical</span>
    <span class="c1"># bit instead of a qubit</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">qubit</span><span class="p">)</span><span class="o">.</span><span class="n">c_if</span><span class="p">(</span><span class="n">crx</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># Apply gates if the registers </span>
    <span class="n">qc</span><span class="o">.</span><span class="n">z</span><span class="p">(</span><span class="n">qubit</span><span class="p">)</span><span class="o">.</span><span class="n">c_if</span><span class="p">(</span><span class="n">crz</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># are in the state &#39;1&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## SETUP</span>
<span class="c1"># Protocol uses 3 qubits and 2 classical bits in 2 different registers</span>
<span class="n">qr</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;q&quot;</span><span class="p">)</span>
<span class="n">crz</span><span class="p">,</span> <span class="n">crx</span> <span class="o">=</span> <span class="n">ClassicalRegister</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;crz&quot;</span><span class="p">),</span> <span class="n">ClassicalRegister</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;crx&quot;</span><span class="p">)</span>
<span class="n">teleportation_circuit</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">qr</span><span class="p">,</span> <span class="n">crz</span><span class="p">,</span> <span class="n">crx</span><span class="p">)</span>

<span class="c1">## STEP 1</span>
<span class="n">create_bell_pair</span><span class="p">(</span><span class="n">teleportation_circuit</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1">## STEP 2</span>
<span class="n">teleportation_circuit</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span> <span class="c1"># Use barrier to separate steps</span>
<span class="n">alice_gates</span><span class="p">(</span><span class="n">teleportation_circuit</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">## STEP 3</span>
<span class="n">measure_and_send</span><span class="p">(</span><span class="n">teleportation_circuit</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">## STEP 4</span>
<span class="n">teleportation_circuit</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span> <span class="c1"># Use barrier to separate steps</span>
<span class="n">bob_gates</span><span class="p">(</span><span class="n">teleportation_circuit</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">crz</span><span class="p">,</span> <span class="n">crx</span><span class="p">)</span>
<span class="n">teleportation_circuit</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../../_images/lab7-book_20_0.png" src="../../../../../_images/lab7-book_20_0.png" />
</div>
</div>
<p>And voila! At the end of this protocol, Alice’s qubit has now teleported to Bob.</p>
</section>
</section>
<section id="simulating-the-teleportation-protocol-a-id-simulating-a">
<h2>3. Simulating the Teleportation Protocol <a id='simulating'></a><a class="headerlink" href="#simulating-the-teleportation-protocol-a-id-simulating-a" title="Permalink to this headline">¶</a></h2>
<section id="how-will-we-test-the-protocol-on-a-quantum-computer-a-id-testing-a">
<h3>3.1 How Will We Test the Protocol on a Quantum Computer? <a id='testing'></a><a class="headerlink" href="#how-will-we-test-the-protocol-on-a-quantum-computer-a-id-testing-a" title="Permalink to this headline">¶</a></h3>
<p>In this notebook, we will initialize Alice’s qubit in a random state <span class="math notranslate nohighlight">\(\vert\psi\rangle\)</span> (<code class="docutils literal notranslate"><span class="pre">psi</span></code>). This state will be created using an <code class="docutils literal notranslate"><span class="pre">Initialize</span></code> gate on <span class="math notranslate nohighlight">\(|q_0\rangle\)</span>. In this chapter we use the function <code class="docutils literal notranslate"><span class="pre">random_state</span></code> to choose <code class="docutils literal notranslate"><span class="pre">psi</span></code> for us, but feel free to set <code class="docutils literal notranslate"><span class="pre">psi</span></code> to any qubit state you want.</p>
<div class="cell tag_thebelab-init docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create random 1-qubit state</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">psi</span> <span class="o">=</span> <span class="n">random_state</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Display it nicely</span>
<span class="n">array_to_latex</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">pretext</span><span class="o">=</span><span class="s2">&quot;|</span><span class="se">\\</span><span class="s2">psi</span><span class="se">\\</span><span class="s2">rangle =&quot;</span><span class="p">)</span>
<span class="c1"># Show it on a Bloch sphere</span>
<span class="n">plot_bloch_multivector</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle 
|\psi\rangle =\begin{bmatrix}
0.19721 + 0.8694i \\
0.41518 + 0.18133i
\end{bmatrix}
\end{split}\]</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/conda/lib/python3.8/site-packages/qiskit/visualization/bloch.py:69: MatplotlibDeprecationWarning: 
The M attribute was deprecated in Matplotlib 3.4 and will be removed two minor releases later. Use self.axes.M instead.
  x_s, y_s, _ = proj3d.proj_transform(xs3d, ys3d, zs3d, renderer.M)
</pre></div>
</div>
<img alt="../../../../../_images/lab7-book_25_2.png" src="../../../../../_images/lab7-book_25_2.png" />
</div>
</div>
<p>Let’s create our initialization instruction to create <span class="math notranslate nohighlight">\(|\psi\rangle\)</span> from the state <span class="math notranslate nohighlight">\(|0\rangle\)</span>:</p>
<div class="cell tag_thebelab-init docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">init_gate</span> <span class="o">=</span> <span class="n">Initialize</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span>
<span class="n">init_gate</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;init&quot;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-1">
<h3>Exercise 1<a class="headerlink" href="#exercise-1" title="Permalink to this headline">¶</a></h3>
<p>Let’s say the state $<span class="math notranslate nohighlight">\(|\phi\rangle = \begin{bmatrix} a_0 + ia_1 \\ b_0 \end{bmatrix} \)</span><span class="math notranslate nohighlight">\( is orthogonal to state \)</span>|\psi\rangle <span class="math notranslate nohighlight">\( we defined above. In order to find the values for \)</span>a_0,a_1<span class="math notranslate nohighlight">\( and \)</span>b_0<span class="math notranslate nohighlight">\( we need three linearly independent equations. Solving them can be a lot of work, so I just want you to write down three linearly independent equations. In other words, what are the conditions for \)</span>|\phi\rangle<span class="math notranslate nohighlight">\( to be a normalized and an orthogonal state to \)</span>|\psi\rangle$?</p>
</section>
<section id="answer">
<h3>Answer<a class="headerlink" href="#answer" title="Permalink to this headline">¶</a></h3>
<p>?</p>
<p>(<code class="docutils literal notranslate"><span class="pre">Initialize</span></code> is technically not a gate since it contains a reset operation, and so is not reversible. We call it an ‘instruction’ instead). If the quantum teleportation circuit works, then at the end of the circuit the qubit <span class="math notranslate nohighlight">\(|q_2\rangle\)</span> will be in this state. We will check this using the statevector simulator.</p>
</section>
<section id="using-the-statevector-simulator-a-id-simulating-sv-a">
<h3>3.2 Using the Statevector Simulator <a id='simulating-sv'></a><a class="headerlink" href="#using-the-statevector-simulator-a-id-simulating-sv-a" title="Permalink to this headline">¶</a></h3>
<p>We can use the statevector simulator to verify our qubit has been teleported.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## SETUP</span>
<span class="n">qr</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;q&quot;</span><span class="p">)</span>   <span class="c1"># Protocol uses 3 qubits</span>
<span class="n">crz</span> <span class="o">=</span> <span class="n">ClassicalRegister</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;crz&quot;</span><span class="p">)</span> <span class="c1"># and 2 classical registers</span>
<span class="n">crx</span> <span class="o">=</span> <span class="n">ClassicalRegister</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;crx&quot;</span><span class="p">)</span>
<span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">qr</span><span class="p">,</span> <span class="n">crz</span><span class="p">,</span> <span class="n">crx</span><span class="p">)</span>

<span class="c1">## STEP 0</span>
<span class="c1"># First, let&#39;s initialize Alice&#39;s q0</span>
<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">init_gate</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">qc</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>

<span class="c1">## STEP 1</span>
<span class="c1"># Now begins the teleportation protocol</span>
<span class="n">create_bell_pair</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>

<span class="c1">## STEP 2</span>
<span class="c1"># Send q1 to Alice and q2 to Bob</span>
<span class="n">alice_gates</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">## STEP 3</span>
<span class="c1"># Alice then sends her classical bits to Bob</span>
<span class="n">measure_and_send</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">## STEP 4</span>
<span class="c1"># Bob decodes qubits</span>
<span class="n">bob_gates</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">crz</span><span class="p">,</span> <span class="n">crx</span><span class="p">)</span>

<span class="c1"># Display the circuit</span>
<span class="n">qc</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../../_images/lab7-book_32_0.png" src="../../../../../_images/lab7-book_32_0.png" />
</div>
</div>
<p>We can see below, using our statevector simulator, that the state of <span class="math notranslate nohighlight">\(|q_2\rangle\)</span> is the same as the state <span class="math notranslate nohighlight">\(|\psi\rangle\)</span> we created above, while the states of <span class="math notranslate nohighlight">\(|q_0\rangle\)</span> and <span class="math notranslate nohighlight">\(|q_1\rangle\)</span> have been collapsed to either <span class="math notranslate nohighlight">\(|0\rangle\)</span> or <span class="math notranslate nohighlight">\(|1\rangle\)</span>. The state <span class="math notranslate nohighlight">\(|\psi\rangle\)</span> has been teleported from qubit 0 to qubit 2.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sv_sim</span> <span class="o">=</span> <span class="n">Aer</span><span class="o">.</span><span class="n">get_backend</span><span class="p">(</span><span class="s1">&#39;statevector_simulator&#39;</span><span class="p">)</span>
<span class="n">qobj</span> <span class="o">=</span> <span class="n">assemble</span><span class="p">(</span><span class="n">qc</span><span class="p">)</span>
<span class="n">out_vector</span> <span class="o">=</span> <span class="n">sv_sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qobj</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_statevector</span><span class="p">()</span>
<span class="n">plot_bloch_multivector</span><span class="p">(</span><span class="n">out_vector</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/conda/lib/python3.8/site-packages/qiskit/visualization/bloch.py:69: MatplotlibDeprecationWarning: 
The M attribute was deprecated in Matplotlib 3.4 and will be removed two minor releases later. Use self.axes.M instead.
  x_s, y_s, _ = proj3d.proj_transform(xs3d, ys3d, zs3d, renderer.M)
</pre></div>
</div>
<img alt="../../../../../_images/lab7-book_34_1.png" src="../../../../../_images/lab7-book_34_1.png" />
</div>
</div>
<p>You can run this cell a few times to make sure. You may notice that the qubits 0 &amp; 1 change states, but qubit 2 is always in the state <span class="math notranslate nohighlight">\(|\psi\rangle\)</span>.</p>
</section>
<section id="using-the-qasm-simulator-a-id-simulating-qs-a">
<h3>3.3 Using the QASM Simulator <a id='simulating-qs'></a><a class="headerlink" href="#using-the-qasm-simulator-a-id-simulating-qs-a" title="Permalink to this headline">¶</a></h3>
<p>Quantum teleportation is designed to send qubits between two parties. We do not have the hardware to demonstrate this, but we can demonstrate that the gates perform the correct transformations on a single quantum chip. Here we use the QASM simulator to simulate how we might test our protocol.</p>
<p>On a real quantum computer, we would not be able to sample the statevector, so if we wanted to check our teleportation circuit is working, we need to do things slightly differently. The <code class="docutils literal notranslate"><span class="pre">Initialize</span></code> instruction first performs a reset, setting our qubit to the state <span class="math notranslate nohighlight">\(|0\rangle\)</span>. It then applies gates to turn our <span class="math notranslate nohighlight">\(|0\rangle\)</span> qubit into the state <span class="math notranslate nohighlight">\(|\psi\rangle\)</span>:</p>
<div class="math notranslate nohighlight">
\[ |0\rangle \xrightarrow{\text{Initialize gates}} |\psi\rangle \]</div>
<p>Since all quantum gates are reversible, we can find the inverse of these gates using:</p>
<div class="cell tag_thebelab-init docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inverse_init_gate</span> <span class="o">=</span> <span class="n">init_gate</span><span class="o">.</span><span class="n">gates_to_uncompute</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>This operation has the property:</p>
<div class="math notranslate nohighlight">
\[ |\psi\rangle \xrightarrow{\text{Inverse Initialize gates}} |0\rangle \]</div>
<p>To prove the qubit <span class="math notranslate nohighlight">\(|q_0\rangle\)</span> has been teleported to <span class="math notranslate nohighlight">\(|q_2\rangle\)</span>, if we do this inverse initialization on <span class="math notranslate nohighlight">\(|q_2\rangle\)</span>, we expect to measure <span class="math notranslate nohighlight">\(|0\rangle\)</span> with certainty. We do this in the circuit below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## SETUP</span>
<span class="n">qr</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;q&quot;</span><span class="p">)</span>   <span class="c1"># Protocol uses 3 qubits</span>
<span class="n">crz</span> <span class="o">=</span> <span class="n">ClassicalRegister</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;crz&quot;</span><span class="p">)</span> <span class="c1"># and 2 classical registers</span>
<span class="n">crx</span> <span class="o">=</span> <span class="n">ClassicalRegister</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;crx&quot;</span><span class="p">)</span>
<span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">qr</span><span class="p">,</span> <span class="n">crz</span><span class="p">,</span> <span class="n">crx</span><span class="p">)</span>

<span class="c1">## STEP 0</span>
<span class="c1"># First, let&#39;s initialize Alice&#39;s q0</span>
<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">init_gate</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">qc</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>

<span class="c1">## STEP 1</span>
<span class="c1"># Now begins the teleportation protocol</span>
<span class="n">create_bell_pair</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>

<span class="c1">## STEP 2</span>
<span class="c1"># Send q1 to Alice and q2 to Bob</span>
<span class="n">alice_gates</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">## STEP 3</span>
<span class="c1"># Alice then sends her classical bits to Bob</span>
<span class="n">measure_and_send</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">## STEP 4</span>
<span class="c1"># Bob decodes qubits</span>
<span class="n">bob_gates</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">crz</span><span class="p">,</span> <span class="n">crx</span><span class="p">)</span>

<span class="c1">## STEP 5</span>
<span class="c1"># reverse the initialization process</span>
<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inverse_init_gate</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">])</span>

<span class="c1"># Display the circuit</span>
<span class="n">qc</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../../_images/lab7-book_39_0.png" src="../../../../../_images/lab7-book_39_0.png" />
</div>
</div>
<p>We can see the <code class="docutils literal notranslate"><span class="pre">inverse_init_gate</span></code> appearing, labelled ‘disentangler’ on the circuit diagram. Finally, we measure the third qubit and store the result in the third classical bit:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Need to add a new ClassicalRegister</span>
<span class="c1"># to see the result</span>
<span class="n">cr_result</span> <span class="o">=</span> <span class="n">ClassicalRegister</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">add_register</span><span class="p">(</span><span class="n">cr_result</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../../_images/lab7-book_41_0.png" src="../../../../../_images/lab7-book_41_0.png" />
</div>
</div>
<p>and we run our experiment:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qasm_sim</span> <span class="o">=</span> <span class="n">Aer</span><span class="o">.</span><span class="n">get_backend</span><span class="p">(</span><span class="s1">&#39;qasm_simulator&#39;</span><span class="p">)</span>
<span class="n">t_qc</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">qasm_sim</span><span class="p">)</span>
<span class="n">qobj</span> <span class="o">=</span> <span class="n">assemble</span><span class="p">(</span><span class="n">t_qc</span><span class="p">)</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">qasm_sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qobj</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
<span class="n">plot_histogram</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../../_images/lab7-book_43_0.png" src="../../../../../_images/lab7-book_43_0.png" />
</div>
</div>
<p>We can see we have a 100% chance of measuring <span class="math notranslate nohighlight">\(q_2\)</span> (the leftmost bit in the string) in the state <span class="math notranslate nohighlight">\(|0\rangle\)</span>. This is the expected result, and indicates the teleportation protocol has worked properly.</p>
</section>
</section>
<section id="understanding-quantum-teleportation-a-id-understanding-qt">
<h2>4. Understanding Quantum Teleportation <a id="understanding-qt"><a class="headerlink" href="#understanding-quantum-teleportation-a-id-understanding-qt" title="Permalink to this headline">¶</a></h2>
<p>As you have worked with the Quantum Teleportation’s implementation, it is time to understand the mathematics behind the protocol.</p>
<section id="id1">
<h3>Step 1<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Quantum Teleportation begins with the fact that Alice needs to transmit <span class="math notranslate nohighlight">\(|\psi\rangle = \alpha|0\rangle + \beta|1\rangle\)</span> (a random qubit) to Bob. She doesn’t know the state of the qubit. For this, Alice and Bob take the help of a third party (Telamon). Telamon prepares a pair of entangled qubits for Alice and Bob. The entangled qubits could be written in Dirac Notation as:</p>
<div class="math notranslate nohighlight">
\[ |e \rangle = \frac{1}{\sqrt{2}} (|00\rangle + |11\rangle) \]</div>
<p>Alice and Bob each possess one qubit of the entangled pair (denoted as A and B respectively),</p>
<div class="math notranslate nohighlight">
\[|e\rangle = \frac{1}{\sqrt{2}} (|0\rangle_A |0\rangle_B + |1\rangle_A |1\rangle_B) \]</div>
<p>This creates a three qubit quantum system where Alice has the first two qubits and Bob the last one.</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align*}
|\psi\rangle \otimes |e\rangle &amp;= \frac{1}{\sqrt{2}} (\alpha |0\rangle \otimes (|00\rangle + |11\rangle) + \beta |1\rangle \otimes (|00\rangle + |11\rangle))\\
&amp;= \frac{1}{\sqrt{2}} (\alpha|000\rangle + \alpha|011\rangle + \beta|100\rangle + \beta|111\rangle) 
\end{align*}\end{split}\]</div>
</section>
<section id="exercise-2">
<h3>Exercise 2<a class="headerlink" href="#exercise-2" title="Permalink to this headline">¶</a></h3>
<p>Let’s say Telamon is unavailable, instead his son Ajax is. But Ajax can only prepare entangled qubits in the following Bell state:</p>
<div class="math notranslate nohighlight">
\[ |d \rangle =  \frac{1}{\sqrt{2}} (|01\rangle + |10\rangle) \]</div>
<ul class="simple">
<li><p>Design the circuit for initializing this state.</p></li>
<li><p>Write down <span class="math notranslate nohighlight">\(|\psi\rangle \otimes | d \rangle \)</span>.</p></li>
</ul>
</section>
<section id="id2">
<h3>Answer<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>?</p>
<section id="id3">
<h4>Step 2<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>Now according to the protocol Alice applies CNOT gate on her two qubits followed by Hadamard gate on the first qubit. This results in the state:</p>
<div class="math notranslate nohighlight">
\[\begin{split} 
\begin{align*} (H \otimes I \otimes I) (CNOT \otimes I) (|\psi\rangle \otimes |e\rangle)
&amp;=(H \otimes I \otimes I) (CNOT \otimes I) \frac{1}{\sqrt{2}} (\alpha|000\rangle + \alpha|011\rangle + \beta|100\rangle + \beta|111\rangle) \\
&amp;= (H \otimes I \otimes I) \frac{1}{\sqrt{2}} (\alpha|000\rangle + \alpha|011\rangle + \beta|110\rangle + \beta|101\rangle) \\
&amp;= \frac{1}{2}  (\alpha(|000\rangle + |011\rangle + |100\rangle + |111\rangle) + \beta(|010\rangle + |001\rangle - |110\rangle - |101\rangle)) \\
\end{align*}
\end{split}\]</div>
<p>Which can then be separated and written as:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
= \frac{1}{2}(
 &amp; \phantom{+} |00\rangle (\alpha|0\rangle + \beta|1\rangle) \hphantom{\quad )} \\
 &amp; + |01\rangle (\alpha|1\rangle + \beta|0\rangle) \hphantom{\quad )}\\[4pt]
 &amp; + |10\rangle (\alpha|0\rangle - \beta|1\rangle) \hphantom{\quad )}\\[4pt]
 &amp; + |11\rangle (\alpha|1\rangle - \beta|0\rangle) \quad )\\
\end{align*}
\end{split}\]</div>
</section>
</section>
<section id="exercise-3">
<h3>Exercise 3<a class="headerlink" href="#exercise-3" title="Permalink to this headline">¶</a></h3>
<p>In order to use the entangled qubits produced by Ajax to perform quantum teleportation we must modify our protocol. According to the new protocol, Alice will apply a C0NOT gate to her two qubits followed by a Hadamard gate.</p>
<ul class="simple">
<li><p>Explicitly write down <span class="math notranslate nohighlight">\( (H \otimes I \otimes I) (CNOT \otimes I) (|\psi\rangle \otimes |e\rangle)  \)</span></p></li>
<li><p>Decompose the resulted state like the one above. That is <span class="math notranslate nohighlight">\(|00\rangle \otimes (\text{sth})\)</span> for 00,01,10 and 11.</p></li>
</ul>
</section>
<section id="id4">
<h3>Answer<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>?</p>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id5">
<h1>Step 4<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h1>
<p>Bob, on receiving the bits from Alice, knows he can obtain the original state <span class="math notranslate nohighlight">\(|\psi\rangle\)</span> by applying appropriate transformations on his qubit that was once part of the entangled pair.</p>
<p>The transformations he needs to apply are:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{c c c}
\mbox{Bob's State}                 &amp; \mbox{Bits Received} &amp; \mbox{Gate Applied} \\
(\alpha|0\rangle + \beta|1\rangle) &amp; 00                   &amp; I                   \\
(\alpha|1\rangle + \beta|0\rangle) &amp; 01                   &amp; X                   \\
(\alpha|0\rangle - \beta|1\rangle) &amp; 10                   &amp; Z                   \\
(\alpha|1\rangle - \beta|0\rangle) &amp; 11                   &amp; ZX
\end{array}
\end{split}\]</div>
<p>After this step Bob will have successfully reconstructed Alice’s state.</p>
<section id="exercise-4">
<h2>Exercise 4<a class="headerlink" href="#exercise-4" title="Permalink to this headline">¶</a></h2>
<p>Which gates should Bob apply to his qubit to successfully reconstruct Alice’s state? Fill in the table below according to your results from Exercise 3.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{c c c}
\mbox{Bob's State}                 &amp; \mbox{Bits Received} &amp; \mbox{Gate Applied} \\
 &amp; 00                   &amp;                    \\
 &amp; 01                   &amp;                    \\
 &amp; 10                   &amp;                    \\
 &amp; 11                   &amp; 
\end{array}
\end{split}\]</div>
</section>
<section id="id6">
<h2>Answer<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<p>?</p>
</section>
<section id="teleportation-on-a-real-quantum-computer-a-id-real-qc-a">
<h2>5. Teleportation on a Real Quantum Computer <a id='real_qc'></a><a class="headerlink" href="#teleportation-on-a-real-quantum-computer-a-id-real-qc-a" title="Permalink to this headline">¶</a></h2>
<section id="ibm-hardware-and-deferred-measurement-a-id-deferred-measurement-a">
<h3>5.1 IBM hardware and Deferred Measurement <a id='deferred-measurement'></a><a class="headerlink" href="#ibm-hardware-and-deferred-measurement-a-id-deferred-measurement-a" title="Permalink to this headline">¶</a></h3>
<p>The IBM quantum computers currently do not support instructions after measurements, meaning we cannot run the quantum teleportation in its current form on real hardware. Fortunately, this does not limit our ability to perform any computations due to the <em>deferred measurement principle</em> discussed in chapter 4.4 of [1]. The principle states that any measurement can be postponed until the end of the circuit, i.e. we can move all the measurements to the end, and we should see the same results.</p>
<p><img alt="image.png" src="courses/archives/PHYS343/hands-ons/hands-on-7/attachment:image.png" /></p>
<p>Any benefits of measuring early are hardware related: If we can measure early, we may be able to reuse qubits, or reduce the amount of time our qubits are in their fragile superposition. In this example, the early measurement in quantum teleportation would have allowed us to transmit a qubit state without a direct quantum communication channel.</p>
<p>While moving the gates allows us to demonstrate the “teleportation” circuit on real hardware, it should be noted that the benefit of the teleportation process (transferring quantum states via classical channels) is lost.</p>
<p>Let us re-write the <code class="docutils literal notranslate"><span class="pre">bob_gates</span></code> function to <code class="docutils literal notranslate"><span class="pre">new_bob_gates</span></code>:</p>
<div class="cell tag_thebelab-init docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">new_bob_gates</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cz</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And create our new circuit:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># First, let&#39;s initialize Alice&#39;s q0</span>
<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">init_gate</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">qc</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>

<span class="c1"># Now begins the teleportation protocol</span>
<span class="n">create_bell_pair</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>
<span class="c1"># Send q1 to Alice and q2 to Bob</span>
<span class="n">alice_gates</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>
<span class="c1"># Alice sends classical bits to Bob</span>
<span class="n">new_bob_gates</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># We undo the initialization process</span>
<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inverse_init_gate</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">])</span>

<span class="c1"># See the results, we only care about the state of qubit 2</span>
<span class="n">qc</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># View the results:</span>
<span class="n">qc</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../../_images/lab7-book_60_0.png" src="../../../../../_images/lab7-book_60_0.png" />
</div>
</div>
</section>
<section id="executing-a-id-executing-a">
<h3>5.2 Executing <a id='executing'></a><a class="headerlink" href="#executing-a-id-executing-a" title="Permalink to this headline">¶</a></h3>
<div class="cell tag_uses-hardware docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First, see what devices we are allowed to use by loading our saved accounts</span>
<span class="n">IBMQ</span><span class="o">.</span><span class="n">load_account</span><span class="p">()</span>
<span class="n">provider</span> <span class="o">=</span> <span class="n">IBMQ</span><span class="o">.</span><span class="n">get_provider</span><span class="p">(</span><span class="n">hub</span><span class="o">=</span><span class="s1">&#39;ibm-q&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_uses-hardware docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get the least-busy backend at IBM and run the quantum circuit there</span>
<span class="kn">from</span> <span class="nn">qiskit.providers.ibmq</span> <span class="kn">import</span> <span class="n">least_busy</span>
<span class="kn">from</span> <span class="nn">qiskit.tools.monitor</span> <span class="kn">import</span> <span class="n">job_monitor</span>
<span class="n">backend</span> <span class="o">=</span> <span class="n">least_busy</span><span class="p">(</span><span class="n">provider</span><span class="o">.</span><span class="n">backends</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="k">lambda</span> <span class="n">b</span><span class="p">:</span> <span class="n">b</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">n_qubits</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="ow">and</span>
                                   <span class="ow">not</span> <span class="n">b</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">simulator</span> <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">status</span><span class="p">()</span><span class="o">.</span><span class="n">operational</span><span class="o">==</span><span class="kc">True</span><span class="p">))</span>
<span class="n">t_qc</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">optimization_level</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">qobj</span> <span class="o">=</span> <span class="n">assemble</span><span class="p">(</span><span class="n">t_qc</span><span class="p">)</span>
<span class="n">job</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qobj</span><span class="p">)</span>
<span class="n">job_monitor</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>  <span class="c1"># displays job status under cell</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-41-9873ace37c62&gt;:8: DeprecationWarning: Passing a Qobj to Backend.run is deprecated and will be removed in a future release. Please pass in circuits or pulse schedules instead.
  job = backend.run(qobj)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Job Status: job has successfully run
</pre></div>
</div>
</div>
</div>
<div class="cell tag_uses-hardware docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the results and display them</span>
<span class="n">exp_result</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<span class="n">exp_counts</span> <span class="o">=</span> <span class="n">exp_result</span><span class="o">.</span><span class="n">get_counts</span><span class="p">(</span><span class="n">qc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">exp_counts</span><span class="p">)</span>
<span class="n">plot_histogram</span><span class="p">(</span><span class="n">exp_counts</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;0&#39;: 977, &#39;1&#39;: 47}
</pre></div>
</div>
<img alt="../../../../../_images/lab7-book_64_1.png" src="../../../../../_images/lab7-book_64_1.png" />
</div>
</div>
<p>As we see here, there are a few results in which we measured <span class="math notranslate nohighlight">\(|1\rangle\)</span>. These arise due to errors in the gates and the qubits. In contrast, our simulator in the earlier part of the notebook had zero errors in its gates, and allowed error-free teleportation.</p>
<div class="cell tag_uses-hardware docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The experimental error rate : </span><span class="si">{</span><span class="n">exp_counts</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">]</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">exp_counts</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The experimental error rate : 0.046%
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-5">
<h3>Exercise 5<a class="headerlink" href="#exercise-5" title="Permalink to this headline">¶</a></h3>
<p>Now that all theoretical work for using Ajax’s entangled pairs is completed, let’s try it with a real quantum computer! Complete the below parts and run the next cell and see if you have done it correctly!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># First, let&#39;s initialize Alice&#39;s q0</span>
<span class="c1"># We don&#39;t need to change this part!</span>
<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">init_gate</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">qc</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>

<span class="c1"># Now begins the teleportation protocol</span>
<span class="c1"># Initialize 1st and 2nd qubit to |phi&gt; = 1/sqrt(2) * (|01&gt; + |10&gt;)</span>
<span class="c1"># Your code here!</span>

<span class="c1"># Send q1 to Alice and q2 to Bob</span>
<span class="c1"># You don&#39;t need to change this part.</span>
<span class="n">qc</span><span class="o">.</span><span class="n">c0x</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>

<span class="c1"># Alice sends classical bits to Bob</span>
<span class="c1"># This is the part where we Bob applies the transformations you found in Exercise 4. </span>
<span class="c1"># If you need to apply Y gate if a specific classical bit is 1, you can achieve the </span>
<span class="c1"># same effect by applying a CY gate where the control qubit is qubit 1, for classical bit 1.</span>


<span class="c1"># We undo the initialization process</span>
<span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inverse_init_gate</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">])</span>

<span class="c1"># See the results, we only care about the state of qubit 2</span>
<span class="n">qc</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># View the results:</span>
<span class="n">qc</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First run this cell to test your code!</span>
<span class="n">IBMQ</span><span class="o">.</span><span class="n">load_account</span><span class="p">()</span>
<span class="n">provider</span> <span class="o">=</span> <span class="n">IBMQ</span><span class="o">.</span><span class="n">get_provider</span><span class="p">(</span><span class="n">hub</span><span class="o">=</span><span class="s1">&#39;ibm-q&#39;</span><span class="p">)</span>

<span class="c1"># get the least-busy backend at IBM and run the quantum circuit there</span>
<span class="kn">from</span> <span class="nn">qiskit.providers.ibmq</span> <span class="kn">import</span> <span class="n">least_busy</span>
<span class="kn">from</span> <span class="nn">qiskit.tools.monitor</span> <span class="kn">import</span> <span class="n">job_monitor</span>
<span class="n">backend</span> <span class="o">=</span> <span class="n">least_busy</span><span class="p">(</span><span class="n">provider</span><span class="o">.</span><span class="n">backends</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="k">lambda</span> <span class="n">b</span><span class="p">:</span> <span class="n">b</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">n_qubits</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="ow">and</span>
                                   <span class="ow">not</span> <span class="n">b</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">simulator</span> <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">status</span><span class="p">()</span><span class="o">.</span><span class="n">operational</span><span class="o">==</span><span class="kc">True</span><span class="p">))</span>
<span class="n">t_qc</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">optimization_level</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">qobj</span> <span class="o">=</span> <span class="n">assemble</span><span class="p">(</span><span class="n">t_qc</span><span class="p">)</span>
<span class="n">job</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qobj</span><span class="p">)</span>
<span class="n">job_monitor</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>  <span class="c1"># displays job status under cell</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Then this cell !</span>
<span class="c1"># Get the results and display them</span>
<span class="n">exp_result</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<span class="n">exp_counts</span> <span class="o">=</span> <span class="n">exp_result</span><span class="o">.</span><span class="n">get_counts</span><span class="p">(</span><span class="n">qc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">exp_counts</span><span class="p">)</span>
<span class="n">plot_histogram</span><span class="p">(</span><span class="n">exp_counts</span><span class="p">)</span>
<span class="c1"># If you get mostly 0, that means you did it correctly!!!</span>
</pre></div>
</div>
</div>
</div>
<p>This notebook demonstrates the Superdense Coding (SDC) protocol. We first use Qiskit’s simulator to test our quantum circuit, and then try it out on a real quantum computer.</p>
</section>
</section>
<section id="id7">
<h2>Contents<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p><a class="reference external" href="#difference">Superdense Coding and Quantum Teleportation</a></p></li>
<li><p><a class="reference external" href="#process">The Process</a><br />
2.1 <a class="reference external" href="#step1">Step 1</a><br />
2.2 <a class="reference external" href="#step2">Step 2</a><br />
2.3 <a class="reference external" href="#step3">Step 3</a></p></li>
<li><p><a class="reference external" href="#simulating">Simulating the Superdense Coding Protocol</a><br />
3.1 <a class="reference external" href="#visualising">3.1 Visualizing Our Measurements</a></p></li>
<li><p><a class="reference external" href="#real_qc">Superdense Coding on a Real Quantum Computer</a></p></li>
</ol>
</section>
<section id="the-difference-between-superdense-coding-and-quantum-teleportation-a-id-difference-a">
<h2>1. The Difference between Superdense Coding and Quantum Teleportation <a id='difference'></a><a class="headerlink" href="#the-difference-between-superdense-coding-and-quantum-teleportation-a-id-difference-a" title="Permalink to this headline">¶</a></h2>
<p>Quantum teleportation and superdense coding are closely related, to avoid confusion we need to clarify the difference.</p>
<p>Quantum teleportation is a process by which the state of qubit (<span class="math notranslate nohighlight">\(|\psi\rangle\)</span>) can be transmitted from one location to another, using two bits of classical communication and a Bell pair. In other words, we can say it is a protocol that destroys the quantum state of a qubit in one location and recreates it on a qubit at a distant location, with the help of shared entanglement. Superdense coding is a procedure that allows someone to send two classical bits to another party using just a single qubit of communication.</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>Teleportation</p></th>
<th class="text-align:center head"><p>Superdense Coding</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>Transmit one<br>qubit using two<br>classical bits</p></td>
<td class="text-align:center"><p>Transmit two<br>classical bits<br>using one<br>qubit</p></td>
</tr>
</tbody>
</table>
<p>The teleportation protocol can be thought of as a flipped version of the superdense coding protocol, in the sense that Alice and Bob merely “swap their equipment.”</p>
</section>
<section id="the-process-a-id-process-a">
<h2>2. The Process <a id='process'></a><a class="headerlink" href="#the-process-a-id-process-a" title="Permalink to this headline">¶</a></h2>
<p><img alt="image.png" src="courses/archives/PHYS343/hands-ons/hands-on-7/attachment:image.png" /></p>
<section id="step-1-a-id-step1-a">
<h3>2.1 Step 1 <a id='step1'></a><a class="headerlink" href="#step-1-a-id-step1-a" title="Permalink to this headline">¶</a></h3>
<p>The process starts with a third party, who we’ll call Charlie. Two qubits are prepared by Charlie in an entangled state. He initially starts the 2 qubits in the basis state <span class="math notranslate nohighlight">\(|0\rangle\)</span>. He applies Hadamard gate (<span class="math notranslate nohighlight">\(H\)</span>) to the first qubit to create superposition. He then applies CNOT gate (<span class="math notranslate nohighlight">\(CX\)</span>) using the first qubit as a control and the second as the target. This is the entangled state (Bell pair) we mentioned earlier.</p>
<section id="outcome-states">
<h4>Outcome States<a class="headerlink" href="#outcome-states" title="Permalink to this headline">¶</a></h4>
<p>Charlie first applies a Hadamard gate.</p>
<p>When the H-gate is applied to first qubit, it creates superposition and we get the state:</p>
<div class="math notranslate nohighlight">
\[|0+\rangle  =  \tfrac{1}{\sqrt{2}}(|00\rangle + |01\rangle)\]</div>
<p>Then Charlie applies the CNOT gate. The CNOT gate entangles both qubits, i.e. it flips the target if the control is <span class="math notranslate nohighlight">\(|1\rangle\)</span>. Note that the control qubit is our rightmost qubit.</p>
<div class="math notranslate nohighlight">
\[\text{CNOT} \tfrac{1}{\sqrt{2}}(|00\rangle + |01\rangle) = \tfrac{1}{\sqrt{2}}(|00\rangle + |11\rangle)\]</div>
</section>
</section>
<section id="exercise-6">
<h3>Exercise 6<a class="headerlink" href="#exercise-6" title="Permalink to this headline">¶</a></h3>
<p>Let’s say we want to implement a superdense coding protocol but Telamon and Ajax are not available but Ajax’s step brother Teucer is. However, Teucer can only prepare the following entangled state:</p>
<div class="math notranslate nohighlight">
\[ |f \rangle  = \frac{1}{\sqrt{2}} ( |00\rangle - |11 \rangle ) \]</div>
<ul class="simple">
<li><p>Design the circuit for initializing this state.</p></li>
</ul>
</section>
<section id="id8">
<h3>Answer<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>?</p>
</section>
<section id="step-2-a-id-step2-a">
<h3>2.2 Step 2 <a id='step2'></a><a class="headerlink" href="#step-2-a-id-step2-a" title="Permalink to this headline">¶</a></h3>
<p>Charlie sends the first qubit to Alice and the second qubit to Bob. The goal of the protocol is for Alice to send 2 classical bits of information to Bob using her qubit. But before she does, she needs to apply a set of quantum gates to her qubit depending on the 2 bits of information she wants to send:</p>
<section id="encoding-rules-for-superdense-coding-alice-protocol">
<h4>Encoding Rules for Superdense Coding (Alice protocol):<a class="headerlink" href="#encoding-rules-for-superdense-coding-alice-protocol" title="Permalink to this headline">¶</a></h4>
<p><img alt="image.png" src="courses/archives/PHYS343/hands-ons/hands-on-7/attachment:image.png" /></p>
<p>Thus if she wants to send a <code class="docutils literal notranslate"><span class="pre">00</span></code>, she does nothing to her qubit (apply the identity (<span class="math notranslate nohighlight">\(I\)</span>) gate). If she sends a <code class="docutils literal notranslate"><span class="pre">10</span></code>, then she applies the <span class="math notranslate nohighlight">\(X\)</span> gate. Depending on what she wants to send, she applies the appropriate gate, then sends her qubit to Bob for the final step in the process.</p>
</section>
</section>
<section id="exercise-7">
<h3>Exercise 7<a class="headerlink" href="#exercise-7" title="Permalink to this headline">¶</a></h3>
<p>Let’s say Alice does the following operations according to the message she wants to send. Fill in the last column.</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>Intended Message:</p></th>
<th class="text-align:center head"><p>Applied Gate:</p></th>
<th class="text-align:center head"><p>Resulting State(<span class="math notranslate nohighlight">\(\cdot \sqrt{2})\)</span>:</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>00</p></td>
<td class="text-align:center"><p>I</p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>01</p></td>
<td class="text-align:center"><p>X</p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>10</p></td>
<td class="text-align:center"><p>Z</p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>11</p></td>
<td class="text-align:center"><p>XZ</p></td>
<td class="text-align:center"><p></p></td>
</tr>
</tbody>
</table>
</section>
<section id="step-3-a-id-step3-a">
<h3>2.3 Step 3 <a id='step3'></a><a class="headerlink" href="#step-3-a-id-step3-a" title="Permalink to this headline">¶</a></h3>
<p>Bob receives Alice’s qubit (rightmost qubit) and uses his qubit to decode Alice’s message. Notice that he does not need to have knowledge of the state in order to decode it — he simply uses the restoration operation.</p>
<p>Bob applies a CNOT gate using the rightmost qubit as control and the leftmost as target. Then he applies a Hadamard gate and finally performs a measurement on both qubits to extract Alice’s message.</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>Bob Receives:</p></th>
<th class="text-align:center head"><p>After CNOT-gate:</p></th>
<th class="text-align:center head"><p>After H-gate:</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>$</p></td>
<td class="text-align:center"><p>00\rangle +</p></td>
<td class="text-align:center"><p>11\rangle$</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>$</p></td>
<td class="text-align:center"><p>01\rangle +</p></td>
<td class="text-align:center"><p>10\rangle$</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>$</p></td>
<td class="text-align:center"><p>00\rangle -</p></td>
<td class="text-align:center"><p>11\rangle$</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>$-</p></td>
<td class="text-align:center"><p>01\rangle +</p></td>
<td class="text-align:center"><p>10\rangle$</p></td>
</tr>
</tbody>
</table>
<p>When Bob performs the measurements, he is certain to get the message Alice sent him. Note that the last outcome has a negative sign <span class="math notranslate nohighlight">\(-|11\rangle\)</span>, writing it as <span class="math notranslate nohighlight">\(|11\rangle\)</span> is also correct as this is global phase and is not measureable.</p>
</section>
<section id="exercise-8">
<h3>Exercise 8<a class="headerlink" href="#exercise-8" title="Permalink to this headline">¶</a></h3>
<p>After Bob receives the state in Exercise 7, he should perform three operations to get the classical message. He should first apply a CNOT gate, then a Hadamard to the first qubit, then a X gate to the first qubit. Fill in the table below to see if this procedure allows Bob to receive the classical message correctly. Note that the first column of the following table should be the last column of the table in Exercise 7!</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>Bob Receives:</p></th>
<th class="text-align:center head"><p>After CNOT-gate:</p></th>
<th class="text-align:center head"><p>After H-gate:</p></th>
<th class="text-align:center head"><p>After X-gate:</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="simulating-the-superdense-coding-protocol-a-id-simulating-a">
<h2>3. Simulating the Superdense Coding Protocol <a id='simulating'></a><a class="headerlink" href="#simulating-the-superdense-coding-protocol-a-id-simulating-a" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importing everything</span>
<span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="n">QuantumCircuit</span>
<span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="n">IBMQ</span><span class="p">,</span> <span class="n">Aer</span><span class="p">,</span> <span class="n">transpile</span><span class="p">,</span> <span class="n">assemble</span>
<span class="kn">from</span> <span class="nn">qiskit.visualization</span> <span class="kn">import</span> <span class="n">plot_histogram</span>
</pre></div>
</div>
</div>
</div>
<p>We saw that to create an entangled pair, we needed to do a H-gate followed by a CNOT. Let’s create a function that takes a <code class="docutils literal notranslate"><span class="pre">QuantumCircuit</span></code> and entangles the qubits with indices <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define a function that takes a QuantumCircuit (qc) </span>
<span class="c1"># and two integers (a &amp; b)</span>
<span class="k">def</span> <span class="nf">create_bell_pair</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="c1"># Apply a h-gate to the first qubit</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="c1"># Apply a CNOT, using the first qubit as the control</span>
</pre></div>
</div>
</div>
</div>
<p>Next we need to encode our message. We saw that there were four possible messages we could send: <code class="docutils literal notranslate"><span class="pre">00</span></code>, <code class="docutils literal notranslate"><span class="pre">10</span></code>, <code class="docutils literal notranslate"><span class="pre">01</span></code> or <code class="docutils literal notranslate"><span class="pre">11</span></code>. Let’s create a function that takes this message and applies the appropriate gates for us:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define a function that takes a QuantumCircuit (qc)</span>
<span class="c1"># a qubit index (qubit) and a message string (msg)</span>
<span class="k">def</span> <span class="nf">encode_message</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">qubit</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">msg</span> <span class="o">==</span> <span class="s2">&quot;00&quot;</span><span class="p">:</span>
        <span class="k">pass</span>    <span class="c1"># To send 00 we do nothing</span>
    <span class="k">elif</span> <span class="n">msg</span> <span class="o">==</span> <span class="s2">&quot;10&quot;</span><span class="p">:</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">qubit</span><span class="p">)</span> <span class="c1"># To send 10 we apply an X-gate</span>
    <span class="k">elif</span> <span class="n">msg</span> <span class="o">==</span> <span class="s2">&quot;01&quot;</span><span class="p">:</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">z</span><span class="p">(</span><span class="n">qubit</span><span class="p">)</span> <span class="c1"># To send 01 we apply a Z-gate</span>
    <span class="k">elif</span> <span class="n">msg</span> <span class="o">==</span> <span class="s2">&quot;11&quot;</span><span class="p">:</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">z</span><span class="p">(</span><span class="n">qubit</span><span class="p">)</span> <span class="c1"># To send 11, we apply a Z-gate</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">qubit</span><span class="p">)</span> <span class="c1"># followed by an X-gate</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid Message: Sending &#39;00&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, we need to decode our message, we saw we could do this using a CNOT followed by a H-gate. Let’s create a function that does this for us too:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">decode_message</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, we can put this together to complete our protocol.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the quantum circuit with 2 qubits</span>
<span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>


<span class="c1"># First, Charlie creates the entangled pair between Alice and Bob</span>
<span class="n">create_bell_pair</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span> <span class="c1"># This adds a barrier to our circuit. A barrier </span>
             <span class="c1"># separates the gates in our diagram and makes it </span>
             <span class="c1"># clear which part of the circuit is which</span>

<span class="c1"># At this point, qubit 0 goes to Alice and qubit 1 goes to Bob</span>

<span class="c1"># Next, Alice encodes her message onto qubit 0. In this case,</span>
<span class="c1"># we want to send the message &#39;10&#39;. You can try changing this</span>
<span class="c1"># value and see how it affects the circuit</span>
<span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;10&quot;</span>
<span class="n">encode_message</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>
<span class="c1"># Alice then sends her qubit to Bob.</span>

<span class="c1"># After recieving qubit 0, Bob applies the recovery protocol:</span>
<span class="n">decode_message</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Finally, Bob measures his qubits to read Alice&#39;s message</span>
<span class="n">qc</span><span class="o">.</span><span class="n">measure_all</span><span class="p">()</span>

<span class="c1"># Draw our output</span>
<span class="n">qc</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../../_images/lab7-book_90_0.png" src="../../../../../_images/lab7-book_90_0.png" />
</div>
</div>
<section id="visualizing-our-measurements-a-id-visualising-a">
<h3>3.1 Visualizing Our Measurements <a id='visualising'></a><a class="headerlink" href="#visualizing-our-measurements-a-id-visualising-a" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qasm_sim</span> <span class="o">=</span> <span class="n">Aer</span><span class="o">.</span><span class="n">get_backend</span><span class="p">(</span><span class="s1">&#39;qasm_simulator&#39;</span><span class="p">)</span>
<span class="n">qobj</span> <span class="o">=</span> <span class="n">assemble</span><span class="p">(</span><span class="n">qc</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">qasm_sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qobj</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get_counts</span><span class="p">(</span><span class="n">qc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
<span class="n">plot_histogram</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;10&#39;: 1024}
</pre></div>
</div>
<img alt="../../../../../_images/lab7-book_92_1.png" src="../../../../../_images/lab7-book_92_1.png" />
</div>
</div>
<p>Our simulator simulates a perfect quantum computer. We can see that, without errors, we get a 100% chance of measuring the correct message.</p>
</section>
</section>
<section id="superdense-coding-on-a-real-quantum-computer-a-id-real-qc-a">
<h2>4. Superdense Coding on a Real Quantum Computer <a id='real_qc'></a><a class="headerlink" href="#superdense-coding-on-a-real-quantum-computer-a-id-real-qc-a" title="Permalink to this headline">¶</a></h2>
<p>We can now see this working on a real quantum computer. First, we want to load our account to get the least busy quantum system:</p>
<div class="cell tag_uses-hardware docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="n">IBMQ</span>
<span class="kn">from</span> <span class="nn">qiskit.providers.ibmq</span> <span class="kn">import</span> <span class="n">least_busy</span>
<span class="n">shots</span> <span class="o">=</span> <span class="mi">1024</span>

<span class="c1"># Load local account information</span>
<span class="n">IBMQ</span><span class="o">.</span><span class="n">load_account</span><span class="p">()</span>
<span class="c1"># Get the least busy backend</span>
<span class="n">provider</span> <span class="o">=</span> <span class="n">IBMQ</span><span class="o">.</span><span class="n">get_provider</span><span class="p">(</span><span class="n">hub</span><span class="o">=</span><span class="s1">&#39;ibm-q&#39;</span><span class="p">)</span>
<span class="n">backend</span> <span class="o">=</span> <span class="n">least_busy</span><span class="p">(</span><span class="n">provider</span><span class="o">.</span><span class="n">backends</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">n_qubits</span> <span class="o">&gt;=</span> <span class="mi">2</span> 
                                       <span class="ow">and</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">simulator</span> 
                                       <span class="ow">and</span> <span class="n">x</span><span class="o">.</span><span class="n">status</span><span class="p">()</span><span class="o">.</span><span class="n">operational</span><span class="o">==</span><span class="kc">True</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;least busy backend: &quot;</span><span class="p">,</span> <span class="n">backend</span><span class="p">)</span>
<span class="c1"># Run our circuit</span>
<span class="n">t_qc</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">optimization_level</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">qobj</span> <span class="o">=</span> <span class="n">assemble</span><span class="p">(</span><span class="n">t_qc</span><span class="p">)</span>
<span class="n">job</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qobj</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ibmqfactory.load_account:WARNING:2021-05-22 19:29:13,732: Credentials are already in use. The existing account in the session will be replaced.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>least busy backend:  ibmq_manila
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-50-4c5440f57654&gt;:16: DeprecationWarning: Passing a Qobj to Backend.run is deprecated and will be removed in a future release. Please pass in circuits or pulse schedules instead.
  job = backend.run(qobj)
</pre></div>
</div>
</div>
</div>
<div class="cell tag_uses-hardware docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Monitoring our job</span>
<span class="kn">from</span> <span class="nn">qiskit.tools.monitor</span> <span class="kn">import</span> <span class="n">job_monitor</span>
<span class="n">job_monitor</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Job Status: job has successfully run
</pre></div>
</div>
</div>
</div>
<div class="cell tag_uses-hardware docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting our result</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<span class="n">plot_histogram</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get_counts</span><span class="p">(</span><span class="n">qc</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../../_images/lab7-book_97_0.png" src="../../../../../_images/lab7-book_97_0.png" />
</div>
</div>
<p>As we see that there are a few results from the other three states when run in a real quantum computer. These are due to errors in the gates and qubit decoherence. We will learn more about these errors in later sections.</p>
<div class="cell tag_uses-hardware docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">correct_results</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get_counts</span><span class="p">(</span><span class="n">qc</span><span class="p">)[</span><span class="n">message</span><span class="p">]</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="p">(</span><span class="n">correct_results</span><span class="o">/</span><span class="n">shots</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Accuracy = </span><span class="si">{</span><span class="n">accuracy</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Accuracy = 81.74%
</pre></div>
</div>
</div>
</div>
<section id="exercise-9">
<h3>Exercise 9<a class="headerlink" href="#exercise-9" title="Permalink to this headline">¶</a></h3>
<p>Now that all theoretical work for using Teucer’s entangled pairs is completed, let’s try it with a real quantum computer! Complete the below parts and run the next cell and see if you have done it correctly!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the quantum circuit with 2 qubits</span>
<span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>


<span class="c1"># First, Teucer creates the entangled pair between Alice and Bob</span>
<span class="c1"># Your code for initializing |f&gt; = 1/sqrt(2) * (|00&gt; - |11&gt;) here !!</span>

<span class="n">qc</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span> <span class="c1"># This adds a barrier to our circuit. A barrier </span>
             <span class="c1"># separates the gates in our diagram and makes it </span>
             <span class="c1"># clear which part of the circuit is which</span>

<span class="c1"># At this point, qubit 0 goes to Alice and qubit 1 goes to Bob</span>

<span class="c1"># Next, Alice encodes her message onto qubit 0. In this case,</span>
<span class="c1"># we want to send the message &#39;10&#39;. You can try changing this</span>
<span class="c1"># value and see how it affects the circuit</span>
<span class="c1"># You don&#39;t need to change this part !!!</span>
<span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;10&quot;</span>
<span class="k">if</span> <span class="n">message</span> <span class="o">==</span> <span class="s2">&quot;01&quot;</span><span class="p">:</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">message</span> <span class="o">==</span> <span class="s2">&quot;10&quot;</span><span class="p">:</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">z</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">message</span> <span class="o">==</span> <span class="s2">&quot;11&quot;</span><span class="p">:</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">z</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>
<span class="c1"># Alice then sends her qubit to Bob.</span>

<span class="c1"># After recieving qubit 0, Bob applies the recovery protocol:</span>
<span class="c1"># Construct the circuit that applies the receiving protocol decribed in Exercise 8 here !!!</span>


<span class="c1"># Finally, Bob measures his qubits to read Alice&#39;s message</span>
<span class="n">qc</span><span class="o">.</span><span class="n">measure_all</span><span class="p">()</span>

<span class="c1"># Draw our output</span>
<span class="n">qc</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../../_images/lab7-book_101_0.png" src="../../../../../_images/lab7-book_101_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run this cell to test your code!!! </span>

<span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="n">IBMQ</span>
<span class="kn">from</span> <span class="nn">qiskit.providers.ibmq</span> <span class="kn">import</span> <span class="n">least_busy</span>
<span class="n">shots</span> <span class="o">=</span> <span class="mi">1024</span>

<span class="c1"># Load local account information</span>
<span class="n">IBMQ</span><span class="o">.</span><span class="n">load_account</span><span class="p">()</span>
<span class="c1"># Get the least busy backend</span>
<span class="n">provider</span> <span class="o">=</span> <span class="n">IBMQ</span><span class="o">.</span><span class="n">get_provider</span><span class="p">(</span><span class="n">hub</span><span class="o">=</span><span class="s1">&#39;ibm-q&#39;</span><span class="p">)</span>
<span class="n">backend</span> <span class="o">=</span> <span class="n">least_busy</span><span class="p">(</span><span class="n">provider</span><span class="o">.</span><span class="n">backends</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">n_qubits</span> <span class="o">&gt;=</span> <span class="mi">2</span> 
                                       <span class="ow">and</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">simulator</span> 
                                       <span class="ow">and</span> <span class="n">x</span><span class="o">.</span><span class="n">status</span><span class="p">()</span><span class="o">.</span><span class="n">operational</span><span class="o">==</span><span class="kc">True</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;least busy backend: &quot;</span><span class="p">,</span> <span class="n">backend</span><span class="p">)</span>
<span class="c1"># Run our circuit</span>
<span class="n">t_qc</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">optimization_level</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">qobj</span> <span class="o">=</span> <span class="n">assemble</span><span class="p">(</span><span class="n">t_qc</span><span class="p">)</span>
<span class="n">job</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qobj</span><span class="p">)</span>

<span class="c1"># Plotting our result</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<span class="n">plot_histogram</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get_counts</span><span class="p">(</span><span class="n">qc</span><span class="p">))</span>

<span class="c1"># If the result you obtained is mainly the message you wanted to sent, than you did it correctly.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ibmqfactory.load_account:WARNING:2021-05-22 19:36:14,960: Credentials are already in use. The existing account in the session will be replaced.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>least busy backend:  ibmq_manila
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-55-338de7cda6aa&gt;:18: DeprecationWarning: Passing a Qobj to Backend.run is deprecated and will be removed in a future release. Please pass in circuits or pulse schedules instead.
  job = backend.run(qobj)
</pre></div>
</div>
<img alt="../../../../../_images/lab7-book_102_3.png" src="../../../../../_images/lab7-book_102_3.png" />
</div>
</div>
</section>
</section>
<section id="id9">
<h2>Contents<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>Introduction</p></li>
<li><p>Protocol Overview</p></li>
<li><p>Qiskit Example: Without Interception</p></li>
<li><p>Qiskit Example: With Interception</p></li>
<li><p>Risk Analysis</p></li>
</ol>
</section>
<section id="introduction">
<h2>1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>When Alice and Bob want to communicate a secret message (such as Bob’s online banking details) over an insecure channel (such as the internet), it is essential to encrypt the message. Since cryptography is a large area and almost all of it is outside the scope of this textbook, we will have to believe that Alice and Bob having a secret key that no one else knows is useful and allows them to communicate using symmetric-key cryptography.</p>
<p>If Alice and Bob want to use Eve’s classical communication channel to share their key, it is impossible to tell if Eve has made a copy of this key for herself- they must place complete trust in Eve that she is not listening. If, however, Eve provides a quantum communication channel, Alice and Bob no longer need to trust Eve at all- they will know if she tries to read Bob’s message before it gets to Alice.</p>
<p>For some readers, it may be useful to give an idea of how a quantum channel may be physically implemented. An example of a classical channel could be a telephone line; we send electric signals through the line that represent our message (or bits). A proposed example of a quantum communication channel could be some kind of fibre-optic cable, through which we can send individual photons (particles of light). Photons have a property called <em>polarisation,</em> and this polarisation can be one of two states. We can use this to represent a qubit.</p>
</section>
<section id="protocol-overview">
<h2>2. Protocol Overview<a class="headerlink" href="#protocol-overview" title="Permalink to this headline">¶</a></h2>
<p>The protocol makes use of the fact that measuring a qubit can change its state. If Alice sends Bob a qubit, and an eavesdropper (Eve) tries to measure it before Bob does, there is a chance that Eve’s measurement will change the state of the qubit and Bob will not receive the qubit state Alice sent.</p>
<div class="cell tag_thebelab-init docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="n">QuantumCircuit</span><span class="p">,</span> <span class="n">Aer</span><span class="p">,</span> <span class="n">transpile</span><span class="p">,</span> <span class="n">assemble</span>
<span class="kn">from</span> <span class="nn">qiskit.visualization</span> <span class="kn">import</span> <span class="n">plot_histogram</span><span class="p">,</span> <span class="n">plot_bloch_multivector</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Imports Successful&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Imports Successful
</pre></div>
</div>
</div>
</div>
<p>If Alice prepares a qubit in the state <span class="math notranslate nohighlight">\(|+\rangle\)</span> (<code class="docutils literal notranslate"><span class="pre">0</span></code> in the <span class="math notranslate nohighlight">\(X\)</span>-basis), and Bob measures it in the <span class="math notranslate nohighlight">\(X\)</span>-basis, Bob is sure to measure <code class="docutils literal notranslate"><span class="pre">0</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Alice prepares qubit in state |+&gt;</span>
<span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>
<span class="c1"># Alice now sends the qubit to Bob</span>
<span class="c1"># who measures it in the X-basis</span>
<span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Draw and simulate circuit</span>
<span class="n">display</span><span class="p">(</span><span class="n">qc</span><span class="o">.</span><span class="n">draw</span><span class="p">())</span>
<span class="n">qasm_sim</span> <span class="o">=</span> <span class="n">Aer</span><span class="o">.</span><span class="n">get_backend</span><span class="p">(</span><span class="s1">&#39;qasm_simulator&#39;</span><span class="p">)</span>
<span class="n">job</span> <span class="o">=</span> <span class="n">qasm_sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">assemble</span><span class="p">(</span><span class="n">qc</span><span class="p">))</span>
<span class="n">plot_histogram</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_counts</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../../_images/lab7-book_108_0.png" src="../../../../../_images/lab7-book_108_0.png" />
<img alt="../../../../../_images/lab7-book_108_1.png" src="../../../../../_images/lab7-book_108_1.png" />
</div>
</div>
<p>But if Eve tries to measure this qubit in the <span class="math notranslate nohighlight">\(Z\)</span>-basis before it reaches Bob, she will change the qubit’s state from <span class="math notranslate nohighlight">\(|+\rangle\)</span> to either <span class="math notranslate nohighlight">\(|0\rangle\)</span> or <span class="math notranslate nohighlight">\(|1\rangle\)</span>, and Bob is no longer certain to measure <code class="docutils literal notranslate"><span class="pre">0</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Alice prepares qubit in state |+&gt;</span>
<span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Alice now sends the qubit to Bob</span>
<span class="c1"># but Eve intercepts and tries to read it</span>
<span class="n">qc</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>
<span class="c1"># Eve then passes this on to Bob</span>
<span class="c1"># who measures it in the X-basis</span>
<span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Draw and simulate circuit</span>
<span class="n">display</span><span class="p">(</span><span class="n">qc</span><span class="o">.</span><span class="n">draw</span><span class="p">())</span>
<span class="n">qasm_sim</span> <span class="o">=</span> <span class="n">Aer</span><span class="o">.</span><span class="n">get_backend</span><span class="p">(</span><span class="s1">&#39;qasm_simulator&#39;</span><span class="p">)</span>
<span class="n">job</span> <span class="o">=</span> <span class="n">qasm_sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">assemble</span><span class="p">(</span><span class="n">qc</span><span class="p">))</span>
<span class="n">plot_histogram</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_counts</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../../_images/lab7-book_110_0.png" src="../../../../../_images/lab7-book_110_0.png" />
<img alt="../../../../../_images/lab7-book_110_1.png" src="../../../../../_images/lab7-book_110_1.png" />
</div>
</div>
<p>We can see here that Bob now has a 50% chance of measuring <code class="docutils literal notranslate"><span class="pre">1</span></code>, and if he does, he and Alice will know there is something wrong with their channel.</p>
<p>The quantum key distribution protocol involves repeating this process enough times that an eavesdropper has a negligible chance of getting away with this interception. It is roughly as follows:</p>
<p><strong>- Step 1</strong></p>
<p>Alice chooses a string of random bits, e.g.:</p>
<p><code class="docutils literal notranslate"><span class="pre">1000101011010100</span></code></p>
<p>And a random choice of basis for each bit:</p>
<p><code class="docutils literal notranslate"><span class="pre">ZZXZXXXZXZXXXXXX</span></code></p>
<p>Alice keeps these two pieces of information private to herself.</p>
<p><strong>- Step 2</strong></p>
<p>Alice then encodes each bit onto a string of qubits using the basis she chose; this means each qubit is in one of the states <span class="math notranslate nohighlight">\(|0\rangle\)</span>, <span class="math notranslate nohighlight">\(|1\rangle\)</span>, <span class="math notranslate nohighlight">\(|+\rangle\)</span> or <span class="math notranslate nohighlight">\(|-\rangle\)</span>, chosen at random. In this case, the string of qubits would look like this:</p>
<div class="math notranslate nohighlight">
\[ |1\rangle|0\rangle|+\rangle|0\rangle|-\rangle|+\rangle|-\rangle|0\rangle|-\rangle|1\rangle|+\rangle|-\rangle|+\rangle|-\rangle|+\rangle|+\rangle
\]</div>
<p>This is the message she sends to Bob.</p>
<p><strong>- Step 3</strong></p>
<p>Bob then measures each qubit at random, for example, he might use the bases:</p>
<p><code class="docutils literal notranslate"><span class="pre">XZZZXZXZXZXZZZXZ</span></code></p>
<p>And Bob keeps the measurement results private.</p>
<p><strong>- Step 4</strong></p>
<p>Bob and Alice then publicly share which basis they used for each qubit. If Bob measured a qubit in the same basis Alice prepared it in, they use this to form part of their shared secret key, otherwise they discard the information for that bit.</p>
<p><strong>- Step 5</strong></p>
<p>Finally, Bob and Alice share a random sample of their keys, and if the samples match, they can be sure (to a small margin of error) that their transmission is successful.</p>
</section>
<section id="qiskit-example-without-interception">
<h2>3. Qiskit Example: Without Interception<a class="headerlink" href="#qiskit-example-without-interception" title="Permalink to this headline">¶</a></h2>
<p>Let’s first see how the protocol works when no one is listening in, then we can see how Alice and Bob are able to detect an eavesdropper. As always, let’s start by importing everything we need:</p>
<p>To generate pseudo-random keys, we will use the <code class="docutils literal notranslate"><span class="pre">randint</span></code> function from numpy. To make sure you can reproduce the results on this page, we will set the seed to 0:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We will call the length of Alice’s initial message <code class="docutils literal notranslate"><span class="pre">n</span></code>. In this example, Alice will send a message 100 qubits long:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
</pre></div>
</div>
</div>
</div>
<section id="id10">
<h3>3.1 Step 1:<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>Alice generates her random set of bits:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
<span class="c1">## Step 1</span>
<span class="c1"># Alice generates bits</span>
<span class="n">alice_bits</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">alice_bits</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0 1 1 0 1 1 1 1 1 1 1 0 0 1 0 0 0 0 0 1 0 1 1 0 0 1 1 1 1 0 1 0 1 0 1 1 0
 1 1 0 0 1 0 1 1 1 1 1 0 1 0 1 1 1 1 0 1 0 0 1 1 0 1 0 1 0 0 0 0 0 1 1 0 0
 0 1 1 0 1 0 0 1 0 1 1 1 1 1 1 0 1 1 0 0 1 0 0 1 1 0]
</pre></div>
</div>
</div>
</div>
<p>At the moment, the set of bits ‘<code class="docutils literal notranslate"><span class="pre">alice_bits</span></code>’ is only known to Alice. We will keep track of what information is only known to Alice, what information is only known to Bob, and what has been sent over Eve’s channel in a table like this:</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>Alice’s Knowledge</p></th>
<th class="text-align:center head"><p>Over Eve’s Channel</p></th>
<th class="text-align:center head"><p>Bob’s Knowledge</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>alice_bits</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p> </p></td>
</tr>
</tbody>
</table>
</section>
<section id="id11">
<h3>3.2 Step 2:<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>Alice chooses to encode each bit on qubit in the <span class="math notranslate nohighlight">\(X\)</span> or <span class="math notranslate nohighlight">\(Z\)</span>-basis at random, and stores the choice for each qubit in <code class="docutils literal notranslate"><span class="pre">alice_bases</span></code>. In this case, a <code class="docutils literal notranslate"><span class="pre">0</span></code> means “prepare in the <span class="math notranslate nohighlight">\(Z\)</span>-basis”, and a <code class="docutils literal notranslate"><span class="pre">1</span></code> means “prepare in the <span class="math notranslate nohighlight">\(X\)</span>-basis”:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
<span class="c1">## Step 1</span>
<span class="c1">#Alice generates bits</span>
<span class="n">alice_bits</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

<span class="c1">## Step 2</span>
<span class="c1"># Create an array to tell us which qubits</span>
<span class="c1"># are encoded in which bases</span>
<span class="n">alice_bases</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">alice_bases</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1 0 0 1 0 0 0 1 1 0 1 0 0 0 0 0 1 0 1 0 1 1 1 1 1 0 1 1 1 1 0 1 1 0 0 1 0
 0 0 0 1 1 0 0 1 0 1 1 1 1 0 0 0 1 0 1 1 1 0 1 0 0 1 0 1 1 0 0 1 0 1 0 1 0
 1 0 1 0 0 0 1 0 1 0 1 0 0 0 0 0 1 0 0 1 0 0 0 1 0 0]
</pre></div>
</div>
</div>
</div>
<p>Alice also keeps this knowledge private:</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>Alice’s Knowledge</p></th>
<th class="text-align:center head"><p>Over Eve’s Channel</p></th>
<th class="text-align:center head"><p>Bob’s Knowledge</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>alice_bits</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>alice_bases</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p> </p></td>
</tr>
</tbody>
</table>
<p>The function <code class="docutils literal notranslate"><span class="pre">encode_message</span></code> below, creates a list of <code class="docutils literal notranslate"><span class="pre">QuantumCircuit</span></code>s, each representing a single qubit in Alice’s message:</p>
<div class="cell tag_thebelab-init docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">encode_message</span><span class="p">(</span><span class="n">bits</span><span class="p">,</span> <span class="n">bases</span><span class="p">):</span>
    <span class="n">message</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bases</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># Prepare qubit in Z-basis</span>
            <span class="k">if</span> <span class="n">bits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">pass</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># Prepare qubit in X-basis</span>
            <span class="k">if</span> <span class="n">bits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>
        <span class="n">message</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">message</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1">## Step 1</span>
<span class="c1"># Alice generates bits</span>
<span class="n">alice_bits</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

<span class="c1">## Step 2</span>
<span class="c1"># Create an array to tell us which qubits</span>
<span class="c1"># are encoded in which bases</span>
<span class="n">alice_bases</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">message</span> <span class="o">=</span> <span class="n">encode_message</span><span class="p">(</span><span class="n">alice_bits</span><span class="p">,</span> <span class="n">alice_bases</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can see that the first bit in <code class="docutils literal notranslate"><span class="pre">alices_bits</span></code> is <code class="docutils literal notranslate"><span class="pre">0</span></code>, and the basis she encodes this in is the <span class="math notranslate nohighlight">\(X\)</span>-basis (represented by <code class="docutils literal notranslate"><span class="pre">1</span></code>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bit = </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">alice_bits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;basis = </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">alice_bases</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>bit = 0
basis = 1
</pre></div>
</div>
</div>
</div>
<p>And if we view the first circuit in <code class="docutils literal notranslate"><span class="pre">message</span></code> (representing the first qubit in Alice’s message), we can verify that Alice has prepared a qubit in the state <span class="math notranslate nohighlight">\(|+\rangle\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">message</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../../_images/lab7-book_127_0.png" src="../../../../../_images/lab7-book_127_0.png" />
</div>
</div>
<p>As another example, we can see that the fourth bit in <code class="docutils literal notranslate"><span class="pre">alice_bits</span></code> is <code class="docutils literal notranslate"><span class="pre">1</span></code>, and it is encoded in the <span class="math notranslate nohighlight">\(Z\)</span>-basis, Alice prepares the corresponding qubit in the state <span class="math notranslate nohighlight">\(|1\rangle\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bit = </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">alice_bits</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;basis = </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">alice_bases</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
<span class="n">message</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>bit = 1
basis = 0
</pre></div>
</div>
<img alt="../../../../../_images/lab7-book_129_1.png" src="../../../../../_images/lab7-book_129_1.png" />
</div>
</div>
<p>This message of qubits is then sent to Bob over Eve’s quantum channel:</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>Alice’s Knowledge</p></th>
<th class="text-align:center head"><p>Over Eve’s Channel</p></th>
<th class="text-align:center head"><p>Bob’s Knowledge</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>alice_bits</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>alice_bases</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>message</p></td>
<td class="text-align:center"><p>message</p></td>
<td class="text-align:center"><p>message</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id12">
<h3>3.3 Step 3:<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>Bob then measures each qubit in the <span class="math notranslate nohighlight">\(X\)</span> or <span class="math notranslate nohighlight">\(Z\)</span>-basis at random and stores this information:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1">## Step 1</span>
<span class="c1"># Alice generates bits</span>
<span class="n">alice_bits</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

<span class="c1">## Step 2</span>
<span class="c1"># Create an array to tell us which qubits</span>
<span class="c1"># are encoded in which bases</span>
<span class="n">alice_bases</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">message</span> <span class="o">=</span> <span class="n">encode_message</span><span class="p">(</span><span class="n">alice_bits</span><span class="p">,</span> <span class="n">alice_bases</span><span class="p">)</span>

<span class="c1">## Step 3</span>
<span class="c1"># Decide which basis to measure in:</span>
<span class="n">bob_bases</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">bob_bases</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1 0 1 0 0 1 1 0 0 0 1 1 0 0 0 0 0 1 0 1 0 0 0 1 1 1 0 0 1 1 1 1 0 0 0 1 1
 0 1 0 0 1 0 1 1 1 1 0 0 0 1 1 1 0 1 1 1 1 0 0 1 1 0 0 0 1 1 0 1 1 1 1 1 0
 0 0 1 0 1 0 1 1 0 0 0 1 0 0 1 1 1 1 0 1 0 0 0 0 1 1]
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">bob_bases</span></code> stores Bob’s choice for which basis he measures each qubit in.</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>Alice’s Knowledge</p></th>
<th class="text-align:center head"><p>Over Eve’s Channel</p></th>
<th class="text-align:center head"><p>Bob’s Knowledge</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>alice_bits</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>alice_bases</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>message</p></td>
<td class="text-align:center"><p>message</p></td>
<td class="text-align:center"><p>message</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>bob_bases</p></td>
</tr>
</tbody>
</table>
<p>Below, the function <code class="docutils literal notranslate"><span class="pre">measure_message</span></code> applies the corresponding measurement and simulates the result of measuring each qubit. We store the measurement results in <code class="docutils literal notranslate"><span class="pre">bob_results</span></code>.</p>
<div class="cell tag_thebelab-init docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">measure_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">bases</span><span class="p">):</span>
    <span class="n">backend</span> <span class="o">=</span> <span class="n">Aer</span><span class="o">.</span><span class="n">get_backend</span><span class="p">(</span><span class="s1">&#39;qasm_simulator&#39;</span><span class="p">)</span>
    <span class="n">measurements</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">bases</span><span class="p">[</span><span class="n">q</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># measuring in Z-basis</span>
            <span class="n">message</span><span class="p">[</span><span class="n">q</span><span class="p">]</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bases</span><span class="p">[</span><span class="n">q</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># measuring in X-basis</span>
            <span class="n">message</span><span class="p">[</span><span class="n">q</span><span class="p">]</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">message</span><span class="p">[</span><span class="n">q</span><span class="p">]</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">qasm_sim</span> <span class="o">=</span> <span class="n">Aer</span><span class="o">.</span><span class="n">get_backend</span><span class="p">(</span><span class="s1">&#39;qasm_simulator&#39;</span><span class="p">)</span>
        <span class="n">qobj</span> <span class="o">=</span> <span class="n">assemble</span><span class="p">(</span><span class="n">message</span><span class="p">[</span><span class="n">q</span><span class="p">],</span> <span class="n">shots</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">memory</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">qasm_sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qobj</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
        <span class="n">measured_bit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get_memory</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">measurements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">measured_bit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">measurements</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1">## Step 1</span>
<span class="c1"># Alice generates bits</span>
<span class="n">alice_bits</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

<span class="c1">## Step 2</span>
<span class="c1"># Create an array to tell us which qubits</span>
<span class="c1"># are encoded in which bases</span>
<span class="n">alice_bases</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">message</span> <span class="o">=</span> <span class="n">encode_message</span><span class="p">(</span><span class="n">alice_bits</span><span class="p">,</span> <span class="n">alice_bases</span><span class="p">)</span>

<span class="c1">## Step 3</span>
<span class="c1"># Decide which basis to measure in:</span>
<span class="n">bob_bases</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">bob_results</span> <span class="o">=</span> <span class="n">measure_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">bob_bases</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can see that the circuit in <code class="docutils literal notranslate"><span class="pre">message[0]</span></code> (representing the 0th qubit) has had an <span class="math notranslate nohighlight">\(X\)</span>-measurement added to it by Bob:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">message</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../../_images/lab7-book_136_0.png" src="../../../../../_images/lab7-book_136_0.png" />
</div>
</div>
<p>Since Bob has by chance chosen to measure in the same basis Alice encoded the qubit in, Bob is guaranteed to get the result <code class="docutils literal notranslate"><span class="pre">0</span></code>. For the 6th qubit (shown below), Bob’s random choice of measurement is not the same as Alice’s, and Bob’s result has only a 50% chance of matching Alices’.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">message</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../../_images/lab7-book_138_0.png" src="../../../../../_images/lab7-book_138_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">bob_results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0]
</pre></div>
</div>
</div>
</div>
<p>Bob keeps his results private.</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>Alice’s Knowledge</p></th>
<th class="text-align:center head"><p>Over Eve’s Channel</p></th>
<th class="text-align:center head"><p>Bob’s Knowledge</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>alice_bits</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>alice_bases</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>message</p></td>
<td class="text-align:center"><p>message</p></td>
<td class="text-align:center"><p>message</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>bob_bases</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>bob_results</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id13">
<h3>3.4 Step 4:<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>After this, Alice reveals (through Eve’s channel) which qubits were encoded in which basis:</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>Alice’s Knowledge</p></th>
<th class="text-align:center head"><p>Over Eve’s Channel</p></th>
<th class="text-align:center head"><p>Bob’s Knowledge</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>alice_bits</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>alice_bases</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>message</p></td>
<td class="text-align:center"><p>message</p></td>
<td class="text-align:center"><p>message</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>bob_bases</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>bob_results</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>alice_bases</p></td>
<td class="text-align:center"><p>alice_bases</p></td>
</tr>
</tbody>
</table>
<p>And Bob reveals which basis he measured each qubit in:</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>Alice’s Knowledge</p></th>
<th class="text-align:center head"><p>Over Eve’s Channel</p></th>
<th class="text-align:center head"><p>Bob’s Knowledge</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>alice_bits</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>alice_bases</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>message</p></td>
<td class="text-align:center"><p>message</p></td>
<td class="text-align:center"><p>message</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>bob_bases</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>bob_results</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>alice_bases</p></td>
<td class="text-align:center"><p>alice_bases</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>bob_bases</p></td>
<td class="text-align:center"><p>bob_bases</p></td>
<td class="text-align:center"><p> </p></td>
</tr>
</tbody>
</table>
<p>If Bob happened to measure a bit in the same basis Alice prepared it in, this means the entry in <code class="docutils literal notranslate"><span class="pre">bob_results</span></code> will match the corresponding entry in <code class="docutils literal notranslate"><span class="pre">alice_bits</span></code>, and they can use that bit as part of their key. If they measured in different bases, Bob’s result is random, and they both throw that entry away. Here is a function <code class="docutils literal notranslate"><span class="pre">remove_garbage</span></code> that does this for us:</p>
<div class="cell tag_thebelab-init docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">remove_garbage</span><span class="p">(</span><span class="n">a_bases</span><span class="p">,</span> <span class="n">b_bases</span><span class="p">,</span> <span class="n">bits</span><span class="p">):</span>
    <span class="n">good_bits</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">a_bases</span><span class="p">[</span><span class="n">q</span><span class="p">]</span> <span class="o">==</span> <span class="n">b_bases</span><span class="p">[</span><span class="n">q</span><span class="p">]:</span>
            <span class="c1"># If both used the same basis, add</span>
            <span class="c1"># this to the list of &#39;good&#39; bits</span>
            <span class="n">good_bits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bits</span><span class="p">[</span><span class="n">q</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">good_bits</span>
</pre></div>
</div>
</div>
</div>
<p>Alice and Bob both discard the useless bits, and use the remaining bits to form their secret keys:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1">## Step 1</span>
<span class="c1"># Alice generates bits</span>
<span class="n">alice_bits</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

<span class="c1">## Step 2</span>
<span class="c1"># Create an array to tell us which qubits</span>
<span class="c1"># are encoded in which bases</span>
<span class="n">alice_bases</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">message</span> <span class="o">=</span> <span class="n">encode_message</span><span class="p">(</span><span class="n">alice_bits</span><span class="p">,</span> <span class="n">alice_bases</span><span class="p">)</span>

<span class="c1">## Step 3</span>
<span class="c1"># Decide which basis to measure in:</span>
<span class="n">bob_bases</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">bob_results</span> <span class="o">=</span> <span class="n">measure_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">bob_bases</span><span class="p">)</span>

<span class="c1">## Step 4</span>
<span class="n">alice_key</span> <span class="o">=</span> <span class="n">remove_garbage</span><span class="p">(</span><span class="n">alice_bases</span><span class="p">,</span> <span class="n">bob_bases</span><span class="p">,</span> <span class="n">alice_bits</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">alice_key</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 1, 0, 0]
</pre></div>
</div>
</div>
</div>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>Alice’s Knowledge</p></th>
<th class="text-align:center head"><p>Over Eve’s Channel</p></th>
<th class="text-align:center head"><p>Bob’s Knowledge</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>alice_bits</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>alice_bases</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>message</p></td>
<td class="text-align:center"><p>message</p></td>
<td class="text-align:center"><p>message</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>bob_bases</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>bob_results</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>alice_bases</p></td>
<td class="text-align:center"><p>alice_bases</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>bob_bases</p></td>
<td class="text-align:center"><p>bob_bases</p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>alice_key</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p> </p></td>
</tr>
</tbody>
</table>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1">## Step 1</span>
<span class="c1"># Alice generates bits</span>
<span class="n">alice_bits</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

<span class="c1">## Step 2</span>
<span class="c1"># Create an array to tell us which qubits</span>
<span class="c1"># are encoded in which bases</span>
<span class="n">alice_bases</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">message</span> <span class="o">=</span> <span class="n">encode_message</span><span class="p">(</span><span class="n">alice_bits</span><span class="p">,</span> <span class="n">alice_bases</span><span class="p">)</span>

<span class="c1">## Step 3</span>
<span class="c1"># Decide which basis to measure in:</span>
<span class="n">bob_bases</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">bob_results</span> <span class="o">=</span> <span class="n">measure_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">bob_bases</span><span class="p">)</span>

<span class="c1">## Step 4</span>
<span class="n">alice_key</span> <span class="o">=</span> <span class="n">remove_garbage</span><span class="p">(</span><span class="n">alice_bases</span><span class="p">,</span> <span class="n">bob_bases</span><span class="p">,</span> <span class="n">alice_bits</span><span class="p">)</span>
<span class="n">bob_key</span> <span class="o">=</span> <span class="n">remove_garbage</span><span class="p">(</span><span class="n">alice_bases</span><span class="p">,</span> <span class="n">bob_bases</span><span class="p">,</span> <span class="n">bob_results</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">bob_key</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 1, 0, 0]
</pre></div>
</div>
</div>
</div>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>Alice’s Knowledge</p></th>
<th class="text-align:center head"><p>Over Eve’s Channel</p></th>
<th class="text-align:center head"><p>Bob’s Knowledge</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>alice_bits</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>alice_bases</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>message</p></td>
<td class="text-align:center"><p>message</p></td>
<td class="text-align:center"><p>message</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>bob_bases</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>bob_results</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>alice_bases</p></td>
<td class="text-align:center"><p>alice_bases</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>bob_bases</p></td>
<td class="text-align:center"><p>bob_bases</p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>alice_key</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>bob_key</p></td>
</tr>
</tbody>
</table>
</section>
<section id="step-5">
<h3>3.5 Step 5:<a class="headerlink" href="#step-5" title="Permalink to this headline">¶</a></h3>
<p>Finally, Bob and Alice compare a random selection of the bits in their keys to make sure the protocol has worked correctly:</p>
<div class="cell tag_thebelab-init docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sample_bits</span><span class="p">(</span><span class="n">bits</span><span class="p">,</span> <span class="n">selection</span><span class="p">):</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">:</span>
        <span class="c1"># use np.mod to make sure the</span>
        <span class="c1"># bit we sample is always in </span>
        <span class="c1"># the list range</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">bits</span><span class="p">))</span>
        <span class="c1"># pop(i) removes the element of the</span>
        <span class="c1"># list at index &#39;i&#39;</span>
        <span class="n">sample</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bits</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">sample</span>
</pre></div>
</div>
</div>
</div>
<p>Alice and Bob both broadcast these publicly, and remove them from their keys as they are no longer secret:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1">## Step 1</span>
<span class="c1"># Alice generates bits</span>
<span class="n">alice_bits</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

<span class="c1">## Step 2</span>
<span class="c1"># Create an array to tell us which qubits</span>
<span class="c1"># are encoded in which bases</span>
<span class="n">alice_bases</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">message</span> <span class="o">=</span> <span class="n">encode_message</span><span class="p">(</span><span class="n">alice_bits</span><span class="p">,</span> <span class="n">alice_bases</span><span class="p">)</span>

<span class="c1">## Step 3</span>
<span class="c1"># Decide which basis to measure in:</span>
<span class="n">bob_bases</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">bob_results</span> <span class="o">=</span> <span class="n">measure_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">bob_bases</span><span class="p">)</span>

<span class="c1">## Step 4</span>
<span class="n">alice_key</span> <span class="o">=</span> <span class="n">remove_garbage</span><span class="p">(</span><span class="n">alice_bases</span><span class="p">,</span> <span class="n">bob_bases</span><span class="p">,</span> <span class="n">alice_bits</span><span class="p">)</span>
<span class="n">bob_key</span> <span class="o">=</span> <span class="n">remove_garbage</span><span class="p">(</span><span class="n">alice_bases</span><span class="p">,</span> <span class="n">bob_bases</span><span class="p">,</span> <span class="n">bob_results</span><span class="p">)</span>

<span class="c1">## Step 5</span>
<span class="n">sample_size</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">bit_selection</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">sample_size</span><span class="p">)</span>

<span class="n">bob_sample</span> <span class="o">=</span> <span class="n">sample_bits</span><span class="p">(</span><span class="n">bob_key</span><span class="p">,</span> <span class="n">bit_selection</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  bob_sample = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bob_sample</span><span class="p">))</span>
<span class="n">alice_sample</span> <span class="o">=</span> <span class="n">sample_bits</span><span class="p">(</span><span class="n">alice_key</span><span class="p">,</span> <span class="n">bit_selection</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;alice_sample = &quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">alice_sample</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  bob_sample = [0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0]
alice_sample = [0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0]
</pre></div>
</div>
</div>
</div>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>Alice’s Knowledge</p></th>
<th class="text-align:center head"><p>Over Eve’s Channel</p></th>
<th class="text-align:center head"><p>Bob’s Knowledge</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>alice_bits</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>alice_bases</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>message</p></td>
<td class="text-align:center"><p>message</p></td>
<td class="text-align:center"><p>message</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>bob_bases</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>bob_results</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>alice_bases</p></td>
<td class="text-align:center"><p>alice_bases</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>bob_bases</p></td>
<td class="text-align:center"><p>bob_bases</p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>alice_key</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>bob_key</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>bob_sample</p></td>
<td class="text-align:center"><p>bob_sample</p></td>
<td class="text-align:center"><p>bob_sample</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>alice_sample</p></td>
<td class="text-align:center"><p>alice_sample</p></td>
<td class="text-align:center"><p>alice_sample</p></td>
</tr>
</tbody>
</table>
<p>If the protocol has worked correctly without interference, their samples should match:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bob_sample</span> <span class="o">==</span> <span class="n">alice_sample</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>If their samples match, it means (with high probability) <code class="docutils literal notranslate"><span class="pre">alice_key</span> <span class="pre">==</span> <span class="pre">bob_key</span></code>. They now share a secret key they can use to encrypt their messages!</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>Alice’s Knowledge</p></th>
<th class="text-align:center head"><p>Over Eve’s Channel</p></th>
<th class="text-align:center head"><p>Bob’s Knowledge</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>alice_bits</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>alice_bases</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>message</p></td>
<td class="text-align:center"><p>message</p></td>
<td class="text-align:center"><p>message</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>bob_bases</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>bob_results</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>alice_bases</p></td>
<td class="text-align:center"><p>alice_bases</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>bob_bases</p></td>
<td class="text-align:center"><p>bob_bases</p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>alice_key</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>bob_key</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>bob_sample</p></td>
<td class="text-align:center"><p>bob_sample</p></td>
<td class="text-align:center"><p>bob_sample</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>alice_sample</p></td>
<td class="text-align:center"><p>alice_sample</p></td>
<td class="text-align:center"><p>alice_sample</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>shared_key</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>shared_key</p></td>
</tr>
</tbody>
</table>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">bob_key</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">alice_key</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;key length = </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">alice_key</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0]
[1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0]
key length = 33
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="qiskit-example-with-interception">
<h2>4. Qiskit Example: <em>With</em> Interception<a class="headerlink" href="#qiskit-example-with-interception" title="Permalink to this headline">¶</a></h2>
<p>Let’s now see how Alice and Bob can tell if Eve has been trying to listen in on their quantum message. We repeat the same steps as without interference, but before Bob receives his qubits, Eve will try and extract some information from them. Let’s set a different seed so we get a specific set of reproducible ‘random’ results:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="id14">
<h3>4.1 Step 1:<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<p>Alice generates her set of random bits:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="c1">## Step 1</span>
<span class="n">alice_bits</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">alice_bits</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0 0 1 1 0 0 0 1 1 1 0 1 1 1 0 1 1 0 0 0 0 1 1 0 0 0 1 0 0 0 0 1 0 1 1 0 1
 0 0 1 1 0 0 1 0 1 0 1 1 1 1 0 1 0 0 1 1 1 0 0 0 1 0 0 0 1 0 0 1 1 0 0 1 1
 1 0 1 1 1 1 1 1 0 1 0 0 1 1 0 1 0 0 0 0 0 1 1 0 1 1]
</pre></div>
</div>
</div>
</div>
</section>
<section id="id15">
<h3>4.2 Step 2:<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<p>Alice encodes these in the <span class="math notranslate nohighlight">\(Z\)</span> and <span class="math notranslate nohighlight">\(X\)</span>-bases at random, and sends these to Bob through Eve’s quantum channel:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="c1">## Step 1</span>
<span class="n">alice_bits</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="c1">## Step 2</span>
<span class="n">alice_bases</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">message</span> <span class="o">=</span> <span class="n">encode_message</span><span class="p">(</span><span class="n">alice_bits</span><span class="p">,</span> <span class="n">alice_bases</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">alice_bases</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1 0 0 1 1 0 1 0 0 0 0 0 0 0 0 0 1 0 0 0 0 1 1 1 1 0 0 1 1 0 0 1 1 1 1 0 0
 1 1 0 0 0 0 0 0 0 0 1 1 0 0 0 1 0 1 1 1 0 0 1 0 1 0 1 1 0 0 1 0 0 1 1 1 1
 1 0 0 0 0 0 1 1 1 0 0 0 0 0 0 1 0 1 0 0 0 1 0 1 1 1]
</pre></div>
</div>
</div>
</div>
<p>In this case, the first qubit in Alice’s message is in the state <span class="math notranslate nohighlight">\(|+\rangle\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">message</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../../_images/lab7-book_163_0.png" src="../../../../../_images/lab7-book_163_0.png" />
</div>
</div>
</section>
<section id="interception">
<h3>Interception!<a class="headerlink" href="#interception" title="Permalink to this headline">¶</a></h3>
<p>Oh no! Eve intercepts the message as it passes through her channel. She tries to measure the qubits in a random selection of bases, in the same way Bob will later.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="c1">## Step 1</span>
<span class="n">alice_bits</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="c1">## Step 2</span>
<span class="n">alice_bases</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">message</span> <span class="o">=</span> <span class="n">encode_message</span><span class="p">(</span><span class="n">alice_bits</span><span class="p">,</span> <span class="n">alice_bases</span><span class="p">)</span>
<span class="c1">## Interception!!</span>
<span class="n">eve_bases</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">intercepted_message</span> <span class="o">=</span> <span class="n">measure_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">eve_bases</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">intercepted_message</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1, 1, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 0, 1, 1, 1, 0, 1, 1]
</pre></div>
</div>
</div>
</div>
<p>We can see the case of qubit 0 below; Eve’s random choice of basis is not the same as Alice’s, and this will change the qubit state from <span class="math notranslate nohighlight">\(|+\rangle\)</span>, to a random state in the <span class="math notranslate nohighlight">\(Z\)</span>-basis, with 50% probability of <span class="math notranslate nohighlight">\(|0\rangle\)</span> or <span class="math notranslate nohighlight">\(|1\rangle\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">message</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../../_images/lab7-book_167_0.png" src="../../../../../_images/lab7-book_167_0.png" />
</div>
</div>
</section>
<section id="id16">
<h3>4.3 Step 3:<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<p>Eve then passes on the qubits to Bob, who measures them at random. In this case, Bob chose (by chance) to measure in the same basis Alice prepared the qubit in. Without interception, Bob would be guaranteed to measure <code class="docutils literal notranslate"><span class="pre">0</span></code>, but because Eve tried to read the message he now has a 50% chance of measuring <code class="docutils literal notranslate"><span class="pre">1</span></code> instead.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="c1">## Step 1</span>
<span class="n">alice_bits</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="c1">## Step 2</span>
<span class="n">alice_bases</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">message</span> <span class="o">=</span> <span class="n">encode_message</span><span class="p">(</span><span class="n">alice_bits</span><span class="p">,</span> <span class="n">alice_bases</span><span class="p">)</span>
<span class="c1">## Interception!!</span>
<span class="n">eve_bases</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">intercepted_message</span> <span class="o">=</span> <span class="n">measure_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">eve_bases</span><span class="p">)</span>
<span class="c1">## Step 3</span>
<span class="n">bob_bases</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">bob_results</span> <span class="o">=</span> <span class="n">measure_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">bob_bases</span><span class="p">)</span>
<span class="n">message</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../../_images/lab7-book_169_0.png" src="../../../../../_images/lab7-book_169_0.png" />
</div>
</div>
</section>
<section id="id17">
<h3>4.4 Step 4:<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<p>Bob and Alice reveal their basis choices, and discard the useless bits:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="c1">## Step 1</span>
<span class="n">alice_bits</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="c1">## Step 2</span>
<span class="n">alice_bases</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">message</span> <span class="o">=</span> <span class="n">encode_message</span><span class="p">(</span><span class="n">alice_bits</span><span class="p">,</span> <span class="n">alice_bases</span><span class="p">)</span>
<span class="c1">## Interception!!</span>
<span class="n">eve_bases</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">intercepted_message</span> <span class="o">=</span> <span class="n">measure_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">eve_bases</span><span class="p">)</span>
<span class="c1">## Step 3</span>
<span class="n">bob_bases</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">bob_results</span> <span class="o">=</span> <span class="n">measure_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">bob_bases</span><span class="p">)</span>
<span class="c1">## Step 4</span>
<span class="n">bob_key</span> <span class="o">=</span> <span class="n">remove_garbage</span><span class="p">(</span><span class="n">alice_bases</span><span class="p">,</span> <span class="n">bob_bases</span><span class="p">,</span> <span class="n">bob_results</span><span class="p">)</span>
<span class="n">alice_key</span> <span class="o">=</span> <span class="n">remove_garbage</span><span class="p">(</span><span class="n">alice_bases</span><span class="p">,</span> <span class="n">bob_bases</span><span class="p">,</span> <span class="n">alice_bits</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id18">
<h3>4.5 Step 5:<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<p>Bob and Alice compare the same random selection of their keys to see if the qubits were intercepted:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="c1">## Step 1</span>
<span class="n">alice_bits</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="c1">## Step 2</span>
<span class="n">alice_bases</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">message</span> <span class="o">=</span> <span class="n">encode_message</span><span class="p">(</span><span class="n">alice_bits</span><span class="p">,</span> <span class="n">alice_bases</span><span class="p">)</span>
<span class="c1">## Interception!!</span>
<span class="n">eve_bases</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">intercepted_message</span> <span class="o">=</span> <span class="n">measure_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">eve_bases</span><span class="p">)</span>
<span class="c1">## Step 3</span>
<span class="n">bob_bases</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">bob_results</span> <span class="o">=</span> <span class="n">measure_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">bob_bases</span><span class="p">)</span>
<span class="c1">## Step 4</span>
<span class="n">bob_key</span> <span class="o">=</span> <span class="n">remove_garbage</span><span class="p">(</span><span class="n">alice_bases</span><span class="p">,</span> <span class="n">bob_bases</span><span class="p">,</span> <span class="n">bob_results</span><span class="p">)</span>
<span class="n">alice_key</span> <span class="o">=</span> <span class="n">remove_garbage</span><span class="p">(</span><span class="n">alice_bases</span><span class="p">,</span> <span class="n">bob_bases</span><span class="p">,</span> <span class="n">alice_bits</span><span class="p">)</span>
<span class="c1">## Step 5</span>
<span class="n">sample_size</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">bit_selection</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">sample_size</span><span class="p">)</span>
<span class="n">bob_sample</span> <span class="o">=</span> <span class="n">sample_bits</span><span class="p">(</span><span class="n">bob_key</span><span class="p">,</span> <span class="n">bit_selection</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  bob_sample = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bob_sample</span><span class="p">))</span>
<span class="n">alice_sample</span> <span class="o">=</span> <span class="n">sample_bits</span><span class="p">(</span><span class="n">alice_key</span><span class="p">,</span> <span class="n">bit_selection</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;alice_sample = &quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">alice_sample</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  bob_sample = [1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0]
alice_sample = [1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bob_sample</span> <span class="o">==</span> <span class="n">alice_sample</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<p>Oh no! Bob’s key and Alice’s key do not match. We know this is because Eve tried to read the message between steps 2 and 3, and changed the qubits’ states. For all Alice and Bob know, this could be due to noise in the channel, but either way they must throw away all their results and try again- Eve’s interception attempt has failed.</p>
</section>
</section>
<section id="risk-analysis">
<h2>5. Risk Analysis<a class="headerlink" href="#risk-analysis" title="Permalink to this headline">¶</a></h2>
<p>For this type of interception, in which Eve measures all the qubits, there is a small chance that Bob and Alice’s samples could match, and Alice sends her vulnerable message through Eve’s channel. Let’s calculate that chance and see how risky quantum key distribution is.</p>
<ul class="simple">
<li><p>For Alice and Bob to use a qubit’s result, they must both have chosen the same basis. If Eve chooses this basis too, she will successfully intercept this bit without introducing any error. There is a 50% chance of this happening.</p></li>
<li><p>If Eve chooses the <em>wrong</em> basis, i.e. a different basis to Alice and Bob, there is still a 50% chance Bob will measure the value Alice was trying to send. In this case, the interception also goes undetected.</p></li>
<li><p>But if Eve chooses the <em>wrong</em> basis, i.e. a different basis to Alice and Bob, there is a 50% chance Bob will not measure the value Alice was trying to send, and this <em>will</em> introduce an error into their keys.</p></li>
</ul>
<p><img alt="image.png" src="courses/archives/PHYS343/hands-ons/hands-on-7/attachment:image.png" /></p>
<p>If Alice and Bob compare 1 bit from their keys, the probability the bits will match is <span class="math notranslate nohighlight">\(0.75\)</span>, and if so they will not notice Eve’s interception. If they measure 2 bits, there is a <span class="math notranslate nohighlight">\(0.75^2 = 0.5625\)</span> chance of the interception not being noticed. We can see that the probability of Eve going undetected can be calculated from the number of bits (<span class="math notranslate nohighlight">\(x\)</span>) Alice and Bob chose to compare:</p>
<div class="math notranslate nohighlight">
\[ P(\text{undetected}) = 0.75^x \]</div>
<p>If we decide to compare 15 bits as we did above, there is a 1.3% chance Eve will be undetected. If this is too risky for us, we could compare 50 bits instead, and have a 0.00006% chance of being spied upon unknowingly.</p>
<p>You can retry the protocol again by running the cell below. Try changing <code class="docutils literal notranslate"><span class="pre">sample_size</span></code> to something low and see how easy it is for Eve to intercept Alice and Bob’s keys.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trials</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">undetected</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="c1"># Step 1</span>
    <span class="n">alice_bits</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="n">alice_bases</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="c1"># Step 2</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">encode_message</span><span class="p">(</span><span class="n">alice_bits</span><span class="p">,</span> <span class="n">alice_bases</span><span class="p">)</span>
    <span class="c1"># Interception!</span>
    <span class="n">eve_bases</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="n">intercepted_message</span> <span class="o">=</span> <span class="n">measure_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">eve_bases</span><span class="p">)</span>
    <span class="c1"># Step 3</span>
    <span class="n">bob_bases</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="n">bob_results</span> <span class="o">=</span> <span class="n">measure_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">bob_bases</span><span class="p">)</span>
    <span class="c1"># Step 4</span>
    <span class="n">bob_key</span> <span class="o">=</span> <span class="n">remove_garbage</span><span class="p">(</span><span class="n">alice_bases</span><span class="p">,</span> <span class="n">bob_bases</span><span class="p">,</span> <span class="n">bob_results</span><span class="p">)</span>
    <span class="n">alice_key</span> <span class="o">=</span> <span class="n">remove_garbage</span><span class="p">(</span><span class="n">alice_bases</span><span class="p">,</span> <span class="n">bob_bases</span><span class="p">,</span> <span class="n">alice_bits</span><span class="p">)</span>
    <span class="c1"># Step 5</span>
    <span class="n">sample_size</span> <span class="o">=</span> <span class="mi">15</span> <span class="c1"># Change this to something lower and see if </span>
                     <span class="c1"># Eve can intercept the message without Alice</span>
                     <span class="c1"># and Bob finding out</span>
    <span class="n">bit_selection</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">sample_size</span><span class="p">)</span>
    <span class="n">bob_sample</span> <span class="o">=</span> <span class="n">sample_bits</span><span class="p">(</span><span class="n">bob_key</span><span class="p">,</span> <span class="n">bit_selection</span><span class="p">)</span>
    <span class="n">alice_sample</span> <span class="o">=</span> <span class="n">sample_bits</span><span class="p">(</span><span class="n">alice_key</span><span class="p">,</span> <span class="n">bit_selection</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">bob_sample</span> <span class="o">!=</span> <span class="n">alice_sample</span><span class="p">:</span>
        <span class="c1">#print(&quot;Eve&#39;s interference was detected.&quot;)</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">undetected</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1">#print(&quot;Eve went undetected!&quot;)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Eve&#39;s interference was undetected %&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">undetected</span><span class="o">/</span><span class="n">trials</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; of the time.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Eve&#39;s interference was undetected %0.2 of the time.
</pre></div>
</div>
</div>
</div>
<section id="exercise-10">
<h3>Exercise 10<a class="headerlink" href="#exercise-10" title="Permalink to this headline">¶</a></h3>
<p>There is nothing unique with X or Z basis states while we are trying to perform a Quantum Key distribution. Let’s say instead of <span class="math notranslate nohighlight">\(|0\rangle, |1\rangle\)</span> set we use <span class="math notranslate nohighlight">\(|R \rangle, |L \rangle\)</span> which we define as:
$<span class="math notranslate nohighlight">\( |R \rangle = \frac{|0\rangle + i|1 \rangle}{\sqrt{2}} \)</span><span class="math notranslate nohighlight">\(
\)</span><span class="math notranslate nohighlight">\( |L \rangle = \frac{|0\rangle - i|1 \rangle}{\sqrt{2}} \)</span>$</p>
<p>Instead of <span class="math notranslate nohighlight">\(|+ \rangle, |- \rangle\)</span> we use <span class="math notranslate nohighlight">\(|U \rangle, |D \rangle\)</span> which we define as:
$<span class="math notranslate nohighlight">\( |U \rangle = 0.92387953|0\rangle + 0.38268343|1 \rangle \)</span><span class="math notranslate nohighlight">\(
\)</span><span class="math notranslate nohighlight">\( |D \rangle = -0.38268343|0\rangle + 0.92387953|1 \rangle \)</span>$</p>
<ul class="simple">
<li><p>Plot <span class="math notranslate nohighlight">\(|R\rangle, |L\rangle, |U\rangle, |D\rangle\)</span> states on the Bloch sphere using the cell below.</p></li>
<li><p>Design the circuit for preparing these states.</p></li>
<li><p>Design the circuits for performing measurement in these states.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write the state you would like to draw in the array format below.</span>
<span class="c1"># For drawing |0&gt;, write [1 0], for drawing |+&gt; write [1/sqrt(2) 1/sqrt(2)]</span>
<span class="n">out_vector</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">plot_bloch_multivector</span><span class="p">(</span><span class="n">out_vector</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[-0.38268343+0.j  0.92387953+0.j]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/conda/lib/python3.8/site-packages/qiskit/visualization/bloch.py:69: MatplotlibDeprecationWarning: 
The M attribute was deprecated in Matplotlib 3.4 and will be removed two minor releases later. Use self.axes.M instead.
  x_s, y_s, _ = proj3d.proj_transform(xs3d, ys3d, zs3d, renderer.M)
</pre></div>
</div>
<img alt="../../../../../_images/lab7-book_178_2.png" src="../../../../../_images/lab7-book_178_2.png" />
</div>
</div>
</section>
<section id="id19">
<h3>Answer<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h3>
<p>?</p>
<p>After completing this exercise, you can actually modify the encode_message and measure_message functions’s relevant parts for preparing and measuring to implement Quantum Key Distribution using these states.</p>
</section>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="../../../../../_sources/courses/archives/PHYS343/hands-ons/hands-on-7/lab7-book.ipynb.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright (CC BY 3.0) https://creativecommons.org/ .<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br/>
    </p>
  </div>
</footer>
  </body>
</html>